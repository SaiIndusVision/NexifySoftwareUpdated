import{e as Pe,j as e}from"./mui-BFA6lQrI.js";import{r as t,f as Le,b as Fe,h as Ge,i as Ve}from"./react-core-CQlor4TK.js";import{p as Ee}from"./nexify-placeholder-img-DvrgdLBk.js";import{u as We,D as Ke}from"./useDynamicPagination-CJOOK1AB.js";import{u as He}from"./useFilterApi-CeY-s8Rk.js";import{C as ke,j as Xe,p as Ze,A as Me,t as qe,F as $e,b as et,c as tt,d as st,I as at,e as lt,B as nt,L as ot,u as f,X as rt,n as Be}from"./index-C_wsCyeP.js";import{a as A,u as it}from"./data-utils-7BzZlo9U.js";import{b as ct,n as dt,s as mt,d as ut}from"./form-tools-DBwiXJwN.js";import"./state-management-hQ1z8sur.js";import"./ui-utils-DmSiVVjI.js";import"./radix-BHg8RD76.js";const pt="data:image/png;base64,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",gt="data:image/png;base64,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",we=Pe(e.jsx("path",{d:"M9 5v2h6.59L4 18.59 5.41 20 17 8.41V15h2V5z"}),"NorthEast"),ht=Pe(e.jsx("path",{d:"M15 19v-2H8.41L20 5.41 18.59 4 7 15.59V9H5v10z"}),"SouthWest"),xt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB8AAAAfCAYAAAAfrhY5AAAACXBIWXMAABCcAAAQnAEmzTo0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAIcSURBVHgB7VfbUQIxFD0RR/1cKxA7sAT9xXGQCoQK0AqECqQDoAJGGdA/sALoADqAXx0FzyVZiWEXAssMfnBmstnc7Obc195kgR1C+TzUAIIjIP0JjHPAUGSvHE+BKm8v2SoZ4AFrYiW5IenwNm1eKLGrW7IxW8Bx7RooYA0cwJNYFmc/ZF9i6xlZ+QM4Z9+nUvmWViw5uUNcFqu+55YFRlaScKi5V/pICiFuAwO2aWhNlIz9BccjI8tjG+BitaTEMv8GFDnfkWfYntxnVAy5uPtS4nnCG8f9JVlYaZm4v3Ct8wFNvsM43nLuTubcdTMOX1zMn+VyTAJf4heSpijnXBFa4ZrM04BTDrtRJIdRQmpYaelEChdaSixIGUvDZ/HXk/AmN5mejSMOLbFjrXSxEZzZcn4hY64RRMVXxRDHuhoJ4MZ8wfIJtVbxxGLFJmX0EaYWLCVXulwKsszerpqVdk0szY6zL9o6+9OufCHbJdnY1Ul6kbKSC3OlZhCPNKwwyNieb85zIBaRn1pGJ0xd7t2sDhemcj2W1nt73Dbj8LNbVfVia7soIN/oOm6eGk+kPBNz6a6Wc1y9bRxgh9iT78n35P+X/EufUocsqQOzyNgeT/SPhciSn2YF5gA5wgYID5GufB3L39mCcPPwhdndpHXdOa9/NYE54cifyu8xahXM8Wm21fI4dXXjvOdNbilQhcdebaFL4vJNhMI/3ZTVcKQqeWcAAAAASUVORK5CYII=",ze="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAATCAYAAAB2pebxAAAACXBIWXMAABCcAAAQnAEmzTo0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAACqSURBVHgB7ZTBCcMwDEUt1b13kAQ6QjJCR+kkHakZoRBy7wi9l8i1DwXF6JuE5JBDPthYQnrIQjY5oG/fN5b/XNdd7iOUwMxPCyIirQkZhyG4FfJpCyF0RNT8z3MSzfhUzZKKdDyjoNQn3avc1vIIohpLlj2JdRvogOwZAuckH//Sc4AQX1VtyS5C0GiXpCGvuK7oHwF6TyAx+TaKPOLlL7PSiT4n5ns6/gCMkEutEIPmAwAAAABJRU5ErkJggg==",ft=({row:i})=>{const[m,F]=t.useState({labelName:i.name||"",shortcutKey:i.shortcut_key||"",colorCode:i.color_code||"#EEE"}),[V,w]=t.useState(!1),g=async()=>{try{const u={name:m.labelName,shortcut_key:m.shortcutKey.toUpperCase(),color_code:m.colorCode,is_active:!0};w(!0),i.id?(await A.put(`http://localhost:8000/api/label/${i.id}/`,u),alert("Label updated successfully!")):(await A.post("http://localhost:8000/api/label/",u),alert("Label added successfully!"))}catch(u){console.error("Error saving label:",u),alert("Failed to save label")}finally{w(!1)}};return e.jsx(ke,{title:i.id?"Update Label":"Add New Label",description:e.jsxs("form",{onSubmit:u=>u.preventDefault(),children:[e.jsx("input",{type:"text",className:"w-full px-2 py-1 border rounded-full mb-2",placeholder:"Label name",value:m.labelName,onChange:u=>F({...m,labelName:u.target.value})}),e.jsx("input",{type:"text",className:"w-full px-2 py-1 border rounded-full mb-2",placeholder:"Shortcut Key (e.g., G)",value:m.shortcutKey,onChange:u=>F({...m,shortcutKey:u.target.value})}),e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium mb-2",children:["Select color:",e.jsx("input",{type:"color",className:"h-8 w-10 rounded-full border",value:m.colorCode,onChange:u=>F({...m,colorCode:u.target.value})})]})]}),onConfirm:g,isLoading:V,children:e.jsx("button",{className:"px-3 py-1 bg-blue-600 text-white hover:bg-blue-700 rounded-full",children:i.id?"Edit":"Add"})})},bt=({row:i})=>{const[m,F]=t.useState(!1),V=async()=>{F(!0);try{await A.delete(`http://localhost:8000/api/label/${i.id}/`,{headers:{accept:"application/json"}}),alert("Label deleted successfully!")}catch(w){console.error("Error deleting label:",w),alert("Failed to delete label.")}finally{F(!1)}};return e.jsx(ke,{title:"Delete Label",description:`Are you sure you want to delete the label "${i.name}"?`,onConfirm:V,isLoading:m,children:e.jsxs("button",{className:"px-3 py-1 bg-red-600 text-white flex justify-center items-center gap-4 hover:bg-red-700 rounded-full",children:["Delete ",e.jsx("img",{src:ze,alt:"Delete",className:"w-4 h-4"})]})})},jt=(i,m,F,V,w,g)=>{const u=[{key:"color_code",id:"color_code",name:"Color",cell:(h,C)=>{const r=C.color_code,B=r.startsWith("#")?r.slice(1):r,E=B.length===3?B.split("").map(te=>te+te).join(""):B,T=parseInt(E.substring(0,2),16),$=parseInt(E.substring(2,4),16),ee=parseInt(E.substring(4,6),16),J=(T*299+$*587+ee*114)/1e3>150?"text-black":"text-white";return e.jsx("button",{className:`px-3 py-1 rounded-full border ${J}`,style:{backgroundColor:r},children:r})}},{key:"name",id:"name",name:"Label Name"},{key:"shortcut_key",id:"shortcut_key",name:"Key assigned"}];return i!=="AnamolyDetection"&&u.push({key:"view",id:"view",name:"",cell:(h,C)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ft,{row:C}),e.jsx(bt,{row:C})]})}),u},Te=[{partner_id:"62940e36-c368-43f8-b978-4111223a1cac",hashed_key:"befb8eadb0fac508d695b7395ec10543m8ctxoh9",role_id:"cdadd7a8-a04a-40ba-a5b3-2b1bf6d788c8",email:"reach2tayib@gmail.com",first_name:"Mohammed",last_name:"Tayib",api_key:"7b4d9b49-1794-4a91-826a-749cf0d8a87a",is_active:!1,business_type:"large_enterprise",created_by:"4b9517bd-692b-459d-b39f-0c6147a67e31",updated_by:null,products:[{id:"80185a93-7242-4680-8922-297d85dfbd2d",name:"Card"}]},{partner_id:"27644155-4cc2-4541-93ea-babd214d7df3",hashed_key:"4f0440dc0a6d253296aff77f4566d9d8m8ctn5re",role_id:"cdadd7a8-a04a-40ba-a5b3-2b1bf6d788c8",email:"sana@gmail.com",first_name:"Sana",last_name:"G",api_key:"eccc2215-82b7-46be-a418-fb2d997224e6",is_active:!0,business_type:"large_enterprise",created_by:null,updated_by:null,products:[]},{partner_id:"274a5724-5e98-49ff-90fe-0a0fd49f6dff",hashed_key:"bbce159e39b5e7ea1096fc42ebfeff03m85s76dn",role_id:"cdadd7a8-a04a-40ba-a5b3-2b1bf6d788c8",email:"contact2tayib@gmail.com",first_name:"Mohammed",last_name:"Tayibulla",api_key:"41dc8bcf-dff0-4152-a11a-49183559bd31",is_active:!0,business_type:"large_enterprise",created_by:null,updated_by:null,products:[]}],yt=({skuId:i,refreshKey:m,tags:F})=>{const{setTitle:V}=Xe();Le(),t.useEffect(()=>{V("")},[V]);const[w,g]=t.useState([]),u=t.useMemo(()=>F==="AnamolyDetection"?{label:null}:i?{sku:i}:{},[F,i]);console.log(u);const{data:h=[],fetchData:C}=Ze("NUSERS.SKU.LABEL_LIST",u);console.log("usersData 28",h),t.useEffect(()=>{C()},[m,C]);const r=We({endpoint:Me.NUSERS.USER.LIST,initialPageSize:10,initialData:Te,dataPath:"transactions",totalRecordsPath:"totalRecords"});He({endpoint:Me.NUSERS.USER.LIST,initialData:Te,baseQueryParams:{}});const[B,E]=t.useState({}),[T,$]=t.useState({}),ee=jt(F),re=r.loading,J=r.error,te=r.totalRecords||0;return console.log(h),t.useEffect(()=>{h&&Array.isArray(h==null?void 0:h.results)&&g(h==null?void 0:h.results)},[h]),e.jsx("div",{className:"flex flex-col py-4",children:e.jsx(Ke,{columns:ee,data:h&&h.length>0?h:w,defaultSortColumn:"niumId",defaultSortDirection:"asc",loading:re,refreshAction:{isRefreshButtonVisible:!1,isLoading:re,hasError:J},paginationMode:"static",onPageChange:async(se,ge)=>[],totalRecords:te})})},ve="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAG4AAABWCAYAAAAucqM7AAAACXBIWXMAABCcAAAQnAEmzTo0AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAMESURBVHgB7d0/TxRBHMbx3wx70WiIdIr/cvYaeQEmyhugtzBIbWODFCYKJYoJdpSeDYkVWphYcRQWdBIruwWNWOnSyMHezrizMscenGiBsM/u80kudzu5S0i+zMxuNSp4sP5YWTspGMJYq2GZHgyl4jRQNKdeM3ZRJtbrUnFa8DBeStXGv1p/8f1RvxTVx29GRho/ZWOr8+dWetmEmXHXzml5M3pKzpxQfqjSMw9qqWS8XXB7HOP9hnhzwngCGs6pejzYcE6V40GHc6oaD+Y57m96PedZk4xJybSDIHTPrqUJ5/SIV0rpP+Qw/FKZ12PZLCl9K5CS8fEevmtJmaxGVj5vmM516cI5Pl6ZTC9tpa/tznWplsoqYThQDAeK4UAxHCiGA8VwoBgOFMOBYjhQDAeK4UAxHCiGA8VwoBgOFMOBYjhQDAeK4UAxHCiGA8VwoBgOFMOBYjhQDAeK4UAxHCiGA8VwoBgOFMOBYjhQDAeK4UAxHCiGA8VwoBgOFMOBYjhQDAeK4UAxHCiGA8VwoBgOFMOBYjhQDAeK4UAxHCiGA8VwoBgOFMOB0mIl8hcbrXIfJoQs30YpFWlREvoBdxoUFVO+jbXJB22NWfIDbz/FQsWzFhl5v5p0roMgCNM9zi74gfmVNpfLAspHS7e2Zmt6MNTtZ5eafp9z0eaWt4WKw822/ClWotWL7G3ncsqPzy3H3OsKxEVz8XaE8ZPBhvuQhYtnzs+mb0332c26O68281+mY+LOjJtfyd13KDXpP3ae4/q0GvNLpos28nKz+0d0ZNzkufe61bVEKmOn/GzLrvM/qI1/GRKrF9PRAT92+3otfQVyo17Kwx0Lxd9juO2q6ybR2kY8c+Fu/rv7ToE9ObFeT9w52iL1/PjlAS1Xz+rsGEs6XGuR3XfLv8s8j59evL93tOfxvVm8xEyma+qo0HHJzjHP7vp7OPDc5VzAm7JnBtL/YdPnNKX0wul4sxHNXon+9L1/PjDb7X/GmLqSviGhQ6V03w9jtlf7k6R5UKy8X8WBPRteZdGpAAAAAElFTkSuQmCC",At=ct({name:mt().min(1,"Version name is required").max(100,"Maximum 100 characters allowed"),sku:dt().nullable().optional()}),vt=()=>it({mutationFn:async i=>(console.log(i),(await A.post("http://localhost:8000/api/versions/",i)).data)}),Nt=({sku:i,onSuccess:m,onCancel:F})=>{const V=parseInt(i,10),{mutate:w,isLoading:g}=vt(),u=ut({resolver:qe(At),defaultValues:{name:"",sku:V}}),h=C=>{const r={name:C.name,sku:C.sku};w(r,{onSuccess:()=>{f.success("Version created successfully",{position:"top-center",duration:4e3}),u.reset(),m==null||m()},onError:B=>{var E,T;console.error("Failed to create version:",B),f.error(`${B instanceof Error?(T=(E=B==null?void 0:B.response)==null?void 0:E.data)==null?void 0:T.message:"Unknown error"}`,{position:"top-center",duration:4e3})}})};return e.jsxs($e,{...u,children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"text-2xl font-secondary font-bold text-[#062393]",children:"Create a New Version"}),e.jsx("div",{className:"text-sm font-secondary font-normal",children:"Fill all the fields"})]}),e.jsxs("form",{onSubmit:u.handleSubmit(h),className:"space-y-6",children:[e.jsx(et,{control:u.control,name:"name",render:({field:C})=>e.jsxs(tt,{children:[e.jsx(st,{children:e.jsx(at,{...C,placeholder:"Version Name*",className:"rounded-full w-full"})}),e.jsx(lt,{})]})}),e.jsx("div",{className:"flex gap-2",children:e.jsx(nt,{type:"submit",disabled:g,className:"w-full rounded-full",children:g?e.jsxs(e.Fragment,{children:[e.jsx(ot,{className:"mr-2 h-4 w-4 animate-spin"}),"Please wait"]}):"Create New Version"})})]})]})},_e=({done:i})=>{const m=t.useRef(null);return t.useEffect(()=>{m.current&&(m.current.style.width=`${i}%`,m.current.style.opacity="1")},[i]),e.jsx("div",{className:"w-[80%] h-[30px] bg-gray-300 rounded-full relative my-2",children:e.jsx("div",{ref:m,className:"h-full rounded-full bg-gradient-to-l from-[#163323] to-[#43996A] text-white flex items-center justify-center text-sm font-medium transition-all duration-1000 ease-in-out opacity-0 min-w-[50px]","data-done":i,children:i>0?`${i}%`:"0%"})})},wt=({skuId:i,version:m,skuVersions:F,selectedVersion:V})=>{const[w,g]=t.useState(!1),[u,h]=t.useState(null),[C,r]=t.useState(0),[B,E]=t.useState(new Set),[T,$]=t.useState([]),[ee,re]=t.useState([]),[J,te]=t.useState(null),[se,ge]=t.useState([]),[he,x]=t.useState(null),[O,k]=t.useState([]),[R,D]=t.useState([]),[q,Y]=t.useState([]),z=s=>{O.includes(s.name)?(k(l=>l.filter(d=>d!==s.name)),D(l=>l.filter(d=>d!==s.version_id)),Y(l=>l.filter(d=>!s.images.includes(d)))):(k(l=>[...l,s.name]),D(l=>[...l,s.version_id]),Y(l=>[...l,...s.images]))},[K,H]=t.useState([]),[I,b]=t.useState(null),[o,U]=t.useState(null),[oe,ae]=t.useState([]);t.useEffect(()=>{(async()=>{try{if(!i)return;const p=await A.get(`http://localhost:8000/api/final-data-set/?sku_id=${i}`,{headers:{accept:"application/json"}}),l=Object.entries(p.data).map(([d,v])=>({name:d,version_id:v.version_id,total_image_count:v.count,images:v.images.map(j=>({id:j.image_url,name:j.image_url.split("/").pop(),url:j.image_url,label_id:j.label_id,label_name:j.label_name,split_label:j.split_label})),labeled_image_count:v.images.filter(j=>j.label_id).length,unlabeled_image_count:v.images.filter(j=>!j.label_id).length,rejected:v.images.filter(j=>j.label_name==="Bad").length}));ge(l),l.length>0&&(setSelectedDatasetName(l[0].name),re(l[0].images))}catch(p){console.error("Failed to fetch datasets",p)}})()},[i]);const[X,xe]=Fe.useState(null),[ie,c]=Fe.useState(null),G=async()=>{var s;try{const l=(s=(await A.get(`http://localhost:8000/api/sku-images-list/?sku_id=${i}&version_id=${m}`)).data.results)==null?void 0:s.map(d=>({id:d.id,name:d.original_filename,url:`http://localhost:8000${d.image}`,label_id:d.label_id||null,label_name:d.label_name||null,label_color_code:d.label_color_code||null}));re(l||[])}catch(p){console.error("Failed to fetch images",p)}};t.useEffect(()=>{G()},[i,m]);const ce=({title:s,imageUrl:p,onClick:l})=>e.jsxs("div",{onClick:l,className:"border rounded-lg shadow-sm p-4 hover:bg-blue-50 cursor-pointer flex flex-col items-center",children:[e.jsx("img",{src:p,alt:s,className:"w-24 h-24 object-cover rounded mb-2"}),e.jsx("h4",{className:"font-semibold text-lg text-gray-800 text-center",children:s})]}),n=({label:s,min:p,max:l,step:d=1,value:v,onChange:j})=>e.jsxs("div",{className:"my-4",children:[e.jsxs("label",{className:"block mb-1 text-sm font-medium text-gray-700",children:[s,": ",e.jsx("span",{className:"font-bold text-blue-600",children:v})]}),e.jsx("input",{type:"range",min:p,max:l,step:d,value:v,onChange:pe=>j(Number(pe.target.value)),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"})]}),_=({isOpen:s,onClose:p,title:l,file:d,parameters:v,onUpdate:j,dualMode:pe})=>{const[P,me]=t.useState({}),[ne,ye]=t.useState(null),be={horizontal_flip:{params:["p"],dual_mode:!1},vertical_flip:{params:["p"],dual_mode:!1},grayscale:{params:["p"],dual_mode:!1},rotation:{params:["degrees"],dual_mode:!0,configBuilder:a=>({degrees:a.degrees,dual_mode:a.dual_mode})},blur:{params:["kernel_size","sigma"],dual_mode:!1,configBuilder:a=>({kernel_size:a.kernel_size,sigma:a.sigma})},brightness:{params:["brightness"],dual_mode:!0,configBuilder:a=>({brightness:a.brightness,dual_mode:a.dual_mode})},contrast:{params:["contrast"],dual_mode:!0,configBuilder:a=>({contrast:a.contrast,dual_mode:a.dual_mode})},hue:{params:["hue"],dual_mode:!0,configBuilder:a=>({hue:a.hue,dual_mode:a.dual_mode})},saturation:{params:["saturation"],dual_mode:!0,configBuilder:a=>({saturation:a.saturation,dual_mode:a.dual_mode})},affine_scale:{params:["scale"],dual_mode:!1,configBuilder:a=>({scale:a.scale})},affine_shear:{params:["shear_x","shear_y"],dual_mode:!0,configBuilder:a=>({shear_x:a.shear_x,shear_y:a.shear_y,dual_mode:a.dual_mode})},resize_maintain_aspect:{params:["size"],dual_mode:!1,configBuilder:a=>({size:a.size})},resize_distort:{params:["width","height"],dual_mode:!1,configBuilder:a=>({width:a.width,height:a.height})},invert:{params:["p"],dual_mode:!1},sharpen:{params:["sharpness_factor","p"],dual_mode:!1,configBuilder:a=>({sharpness_factor:a.sharpness_factor,p:a.p})}};return t.useEffect(()=>{l.toLowerCase().replace(/ /g,"_");const a=v.reduce((S,W)=>({...S,[W.name]:W.default}),{});me(a)},[v,l]),t.useEffect(()=>{if(!d||!s)return;(async()=>{var Q,ue;const S=new FormData;S.append("image",d);const W=l.toLowerCase().replace(/ /g,"_");S.append("modifier_type",W);const N=be[W]||{params:Object.keys(P)},L=N.configBuilder?N.configBuilder({...P,dual_mode:N.dual_mode}):N.params.reduce((M,Ae)=>({...M,[Ae]:P[Ae]}),{});S.append("parameters",JSON.stringify(L));try{const M=await A.post("http://localhost:8000/api/image_modifier/single_modifier/",S);ye({original_image:M.data.original_image,augmented_image:M.data.transformed_pos_image||M.data.transformed_neg_image,dual_images:N.dual_mode?{positive:M.data.transformed_pos_image,negative:M.data.transformed_neg_image}:null})}catch(M){console.error("Error fetching preview",M),f.error(((ue=(Q=M.response)==null?void 0:Q.data)==null?void 0:ue.error)||"Failed to fetch preview",{position:"top-center",duration:4e3})}})()},[d,P,s,l]),t.useEffect(()=>{if(s){const a=l.toLowerCase().replace(/ /g,"_"),S=be[a]||{params:Object.keys(P)},W=S.configBuilder?S.configBuilder({...P,dual_mode:S.dual_mode}):S.params.reduce((L,Q)=>({...L,[Q]:P[Q]}),{});j({modifier_type:a,parameters:W})}},[P,s,l,j]),s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg w-[90%] max-w-xl relative",children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-600",onClick:p,children:"✕"}),e.jsx("h2",{className:"text-xl font-semibold mb-4",children:l}),e.jsx("div",{className:"mb-4",children:v.map(a=>e.jsx(n,{label:a.name.replace(/_/g," ").replace(/\b\w/g,S=>S.toUpperCase()),min:a.min,max:a.max,step:a.step,value:P[a.name]??a.default,onChange:S=>me(W=>({...W,[a.name]:S}))},a.name))}),ne&&e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Original"}),e.jsx("img",{src:`data:image/jpeg;base64,${ne.original_image}`,className:"w-40 h-28 object-cover rounded",alt:"Original"})]}),ne.dual_images?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Positive Transform"}),e.jsx("img",{src:`data:image/jpeg;base64,${ne.dual_images.positive}`,className:"w-40 h-28 object-cover rounded",alt:"Positive Transform"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Negative Transform"}),e.jsx("img",{src:`data:image/jpeg;base64,${ne.dual_images.negative}`,className:"w-40 h-28 object-cover rounded",alt:"Negative Transform"})]})]}):e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Transformed"}),e.jsx("img",{src:`data:image/jpeg;base64,${ne.augmented_image}`,className:"w-40 h-28 object-cover rounded",alt:"Transformed"})]})]})]})}):null},y=({isPreprocessing:s=!1})=>{var W;const[p,l]=t.useState(null),[d,v]=t.useState(null),[j,pe]=t.useState({}),[P,me]=t.useState([]),[ne,ye]=t.useState(null),be=(W=ee[0])==null?void 0:W.url;t.useEffect(()=>{(async()=>{if(be)try{const Q=await(await fetch(be)).blob(),ue=new File([Q],"first-image.jpg",{type:Q.type});l(ue)}catch(L){console.error("Failed to fetch image as file",L)}})()},[be]),t.useEffect(()=>{(async()=>{try{const L=s?"http://localhost:8000/api/image_modifier/list_preprocessor/":"http://localhost:8000/api/image_modifier/list_transform/",Q=await A.get(L),ue=s?Q.data.preprocessors:Q.data.augmentations,M=Object.entries(ue).map(([Ae,Ce])=>({key:Ae,title:Ae.replace(/_/g," ").replace(/\b\w/g,Se=>Se.toUpperCase()),description:Ce.description,parameters:Object.entries(Ce.parameters).map(([Se,Ne])=>({name:Se,min:Ne.min,max:Ne.max,default:Ne.default,step:Ne.step})),dual_mode:Ce.dual_mode}));me(M)}catch(L){console.error("Failed to fetch list",L),f.error(`Failed to fetch ${s?"preprocessors":"augmentations"}`,{position:"top-center",duration:4e3})}})()},[s]);const a=(N,L)=>{pe(M=>({...M,[N]:L}));const Q=s?"preProcessingConfigs":"augmentationConfigs",ue=JSON.parse(localStorage.getItem(Q)||"{}");localStorage.setItem(Q,JSON.stringify({...ue,[N]:L}))},S=async()=>{var Q,ue;if(!p){f.error("Please select an image",{position:"top-center",duration:4e3});return}const N=new FormData;N.append("image",p);const L=Object.values(j).filter(Boolean).map(M=>({modifier_type:M.modifier_type,parameters:M.parameters}));N.append("modifier_config",JSON.stringify(L)),N.append("parameters",JSON.stringify({}));try{const M=await A.post("http://localhost:8000/api/image_modifier/multiple_modifier/",N);ye(M.data),f.success(`${s?"Preprocessing":"Augmentations"} applied successfully`,{position:"top-center",duration:4e3})}catch(M){console.error("Error applying transformations",M),f.error(((ue=(Q=M.response)==null?void 0:Q.data)==null?void 0:ue.error)||`Failed to apply ${s?"preprocessing":"augmentations"}`,{position:"top-center",duration:4e3})}};return e.jsxs("div",{className:"p-4 max-w-4xl mx-auto",children:[e.jsx("div",{className:"grid grid-cols-2 gap-4",children:P.map(({key:N,title:L})=>e.jsx(ce,{title:L,imageUrl:`/media/${N}.png`,onClick:()=>v(N)},N))}),P.map(N=>e.jsx(_,{isOpen:d===N.key,onClose:()=>v(null),title:N.title,file:p,parameters:N.parameters,dualMode:N.dual_mode,onUpdate:L=>a(N.key,L)},N.key)),ne&&e.jsxs("div",{className:"flex gap-4 mt-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Original"}),e.jsx("img",{src:`data:image/jpeg;base64,${ne.original_image}`,className:"w-40 h-28 object-cover rounded",alt:"Original"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Transformed"}),e.jsx("img",{src:`data:image/jpeg;base64,${ne.augmented_image}`,className:"w-40 h-28 object-cover rounded",alt:"Transformed"})]})]}),e.jsx("div",{className:"flex items-center justify-center cursor-pointer my-2",children:e.jsxs("button",{onClick:S,className:"bg-blue-500 text-white py-2 px-4 rounded mb-4",disabled:!p||Object.keys(j).length===0,children:["Apply All ",s?"Preprocessing":"Augmentations"]})})]})},je=[{label:"Select dataset",component:()=>e.jsx("div",{className:"p-4 bg-gray-100 rounded-lg w-full text-green-600",children:e.jsx("div",{className:"flex flex-col rounded-lg p-4 shadow-md gap-3 mb-2 bg-white max-h-96 overflow-y-scroll",children:!V&&se.map(s=>e.jsxs("div",{className:"bg-white flex justify-center flex-col p-4 m-2 shadow-md rounded-lg text-center cursor-pointer",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex gap-4 items-center justify-center",children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4 accent-blue-500",checked:O.includes(s.name),onChange:()=>z(s)}),e.jsx("img",{src:ve,alt:"",className:"w-4 h-4"}),e.jsx("h4",{className:"text-base font-medium",children:s.name})]}),e.jsxs("div",{className:"text-blue-500 font-semibold",children:[s.total_image_count," images"," ",e.jsx(we,{className:"w-5 h-5",fontSize:"small"})]})]}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(_e,{done:s.total_image_count>0?Math.round(s.labeled_image_count/s.total_image_count*100):0})})]},s.version_id))})})},{label:"Select pre-processing methods",component:()=>e.jsx("div",{className:"p-4 bg-gray-100 rounded-lg w-full text-green-600",children:e.jsxs("div",{className:"flex flex-col rounded-lg p-4 shadow-md gap-3 mb-2 bg-white max-h-96 overflow-y-scroll",children:[e.jsx("p",{className:"text-green-600 font-semibold text-xl",children:"Pre-processing Methods"}),e.jsx(y,{isPreprocessing:!0})]})})},{label:"Select Augmentations",component:()=>e.jsx("div",{className:"p-4 bg-gray-100 rounded-lg w-full text-green-600",children:e.jsxs("div",{className:"flex flex-col rounded-lg p-4 shadow-md gap-3 mb-2 bg-white max-h-96 overflow-y-scroll",children:[e.jsx("p",{className:"text-green-600 font-semibold text-xl",children:"Select Augmentations"}),e.jsx(y,{isPreprocessing:!1})]})})},{label:"Select AI model",component:()=>{const s=[{id:"IVAI1",name:"PADIM",description:"PaDiM: Patch Distribution Modeling for anomaly detection"},{id:"IVAI2",name:"PatchCore",description:"PatchCore: Anomaly detection using patch-based representations"},{id:"IVAI3",name:"ReverseDistillation",description:"Reverse Distillation: Anomaly detection via knowledge distillation"}],p=l=>{x(l),localStorage.setItem("selectedModel",l)};return e.jsx("div",{className:"p-4 bg-gray-100 rounded-lg w-full text-green-600",children:s.map((l,d)=>e.jsx("div",{className:`bg-white flex justify-center flex-col p-4 shadow-md border-[2px] rounded-lg text-center cursor-pointer w-full my-2 ${he===l.name?"border-green-600":""}`,onClick:()=>p(l.name),children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"flex gap-4 items-center",children:e.jsx("h4",{className:"font-medium",children:l.id})}),e.jsx("div",{className:"bg-blue-600 text-white rounded-full px-4 py-2",children:l.name==="PADIM"?"recommended":"beta"})]})},d))})}},{label:"Start training",component:()=>{const s=async()=>{var pe;if(!he){f.error("Please select a model and versions",{position:"top-center",duration:4e3});return}const l=JSON.parse(localStorage.getItem("preProcessingConfigs")||"{}"),d=JSON.parse(localStorage.getItem("augmentationConfigs")||"{}"),v=[...Object.values(l),...Object.values(d)];console.log(R);const j={sku_id:i,version_id:R[0],augmentations:JSON.stringify(v),max_epochs:1,fetch_dataset_url:`http://localhost:8000/api/data-set/?sku_id=${i}&version_id=${R}&absolute_path=true`,seed:42,train_batch_size:16,eval_batch_size:16,devices:1,num_workers:2};console.log(j);try{const P=await A.post("http://localhost:8000/api/train-runner/",j,{headers:{accept:"application/json","Content-Type":"application/json"}}),me=(pe=P==null?void 0:P.data)==null?void 0:pe["process.pid"];me?(xe(me),f.success("Training started",{position:"top-center",duration:4e3}),localStorage.removeItem("preProcessingConfigs"),localStorage.removeItem("augmentationConfigs")):f.error("Training started, but no PID returned",{position:"top-center"})}catch(P){console.error("Failed to start training",P),f.error("Failed to start training",{position:"top-center",duration:4e3})}},p=async()=>{if(X)try{await A.delete(`http://localhost:8000/api/train-runner/${X}/`,{headers:{accept:"application/json"}}),f.success("Training stopped",{position:"top-center",duration:4e3}),xe(null)}catch(l){console.error("Failed to stop training",l),f.error("Failed to stop training",{position:"top-center",duration:4e3})}};return e.jsxs("div",{className:"flex flex-col gap-4 items-center justify-center",children:[e.jsx("div",{className:"text-blue-600 flex text-5xl font-bold",children:"Train"}),e.jsx("div",{className:"flex items-center text-center text-green-600 text-lg font-semibold",children:"ML model training"}),X?e.jsx("button",{onClick:p,className:"bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-full",children:"Stop Training"}):e.jsx("button",{onClick:s,className:"bg-primary hover:bg-green-600 text-white py-2 px-4 rounded-full",children:"Start Training"})]})}}],[le,Z]=t.useState([]),[de,Ie]=t.useState(null);t.useEffect(()=>{(async()=>{var p;if(u==="testing")try{const v=(((p=(await A.get(`http://localhost:8000/api/model-explorer/?sku_id=${i}`,{headers:{accept:"application/json"}})).data)==null?void 0:p.model_files)||[]).map(j=>j.absolute_path);Z(v),v.length>0&&!de&&Ie(v[0]),v.length===0&&f.error("No .ckpt files found",{position:"top-center"})}catch(l){console.error("Failed to fetch ckpt files:",l),f.error("Failed to fetch ckpt files",{position:"top-center"})}})()},[i,u]);const Ue=[{label:"Select dataset",component:()=>e.jsx("div",{className:"p-4 bg-gray-100 rounded-lg w-full text-green-600",children:e.jsx("div",{className:"flex flex-col rounded-lg p-4 shadow-md gap-3 mb-2 bg-white max-h-96 overflow-y-scroll",children:!V&&se.map(s=>e.jsxs("div",{className:"bg-white flex justify-center flex-col p-4 m-2 shadow-md rounded-lg text-center cursor-pointer",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex gap-4 items-center justify-center",children:[e.jsx("input",{type:"radio",className:"w-4 h-4 accent-blue-500",checked:I===s.name,onChange:()=>{b(s.name),re(s.images),ae(s.version_id)}}),e.jsx("img",{src:ve,alt:"",className:"w-4 h-4"}),e.jsx("h4",{className:"text-base font-medium",children:s.name})]}),e.jsxs("div",{className:"text-blue-500 font-semibold",children:[s.total_image_count," images"," ",e.jsx(we,{className:"w-5 h-5",fontSize:"small"})]})]}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(_e,{done:s.total_image_count>0?Math.round(s.labeled_image_count/s.total_image_count*100):0})})]},s.version_id))})})},{label:"Select AI model",component:()=>{const s=[{id:"IVAI1",name:"PADIM",description:"PaDiM: Patch Distribution Modeling for anomaly detection"},{id:"IVAI2",name:"PatchCore",description:"PatchCore: Anomaly detection using patch-based representations"},{id:"IVAI3",name:"ReverseDistillation",description:"Reverse Distillation: Anomaly detection via knowledge distillation"}],p=l=>{U(l),localStorage.setItem("selectedModelTest",l)};return e.jsx("div",{className:"p-4 bg-gray-100 rounded-lg w-full text-green-600",children:s.map((l,d)=>e.jsx("div",{className:`bg-white flex justify-center flex-col p-4 shadow-md border-[2px] rounded-lg text-center cursor-pointer w-full my-2 ${o===l.name?"border-green-600":""}`,onClick:()=>p(l.name),children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"flex gap-4 items-center",children:e.jsx("h4",{className:"font-medium",children:l.id})}),e.jsx("div",{className:"bg-blue-600 text-white rounded-full px-4 py-2",children:l.name==="PADIM"?"recommended":"beta"})]})},d))})}},{label:"Select Checkpoint",component:()=>e.jsxs("div",{className:"p-4 bg-gray-100 rounded-lg w-full",children:[e.jsx("div",{className:"text-blue-600 text-lg font-semibold mb-4",children:"Select Checkpoint"}),le.length>0?e.jsx("div",{className:"flex flex-col gap-3",children:le.map((s,p)=>e.jsxs("label",{className:`p-4 rounded-lg cursor-pointer border ${de===s?"border-green-600 bg-green-50":"border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"ckpt",className:"mr-2 accent-blue-600",checked:de===s,onChange:()=>Ie(s)}),s]},p))}):e.jsx("div",{className:"text-red-500 font-medium",children:"No checkpoint files available."})]})},{label:"Start testing",component:()=>{const s=async()=>{var l;if(!o||!de||!I){f.error("Please select dataset, model, and checkpoint",{position:"top-center"});return}try{const d={sku_id:i,version_id:oe,model_name:o,ckpt_path:de};console.log(d);const v=await A.post("http://localhost:8000/api/test-runner/",d,{headers:{accept:"application/json","Content-Type":"application/json"}}),j=(l=v==null?void 0:v.data)==null?void 0:l["process.pid"];j?(c(j),f.success("Testing started",{position:"top-center"})):f.error("Testing started, but no PID returned",{position:"top-center"})}catch(d){console.error("Failed to start testing",d),f.error("Failed to start testing",{position:"top-center"})}},p=async()=>{if(ie)try{await A.delete(`http://localhost:8000/api/test-runner/${ie}/`,{headers:{accept:"application/json"}}),f.success("Testing stopped",{position:"top-center"}),c(null)}catch(l){console.error("Failed to stop testing",l),f.error("Failed to stop testing",{position:"top-center"})}};return e.jsxs("div",{className:"flex flex-col gap-4 items-center justify-center",children:[e.jsx("div",{className:"text-blue-600 text-5xl font-bold",children:"Test"}),e.jsx("div",{className:"text-green-600 text-lg font-semibold",children:"ML model testing"}),ie?e.jsx("button",{onClick:p,className:"bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-full",children:"Stop Testing"}):e.jsx("button",{onClick:s,className:"bg-primary hover:bg-green-600 text-white py-2 px-4 rounded-full",children:"Start Testing"})]})}}],fe=u==="training"?je:u==="testing"?Ue:[],Ye=()=>{g(!0),h(null),r(0),E(new Set)},De=()=>{g(!1),h(null),r(0),E(new Set),setTimeout(()=>{window.location.reload()},1e3)},Qe=()=>{C<fe.length-1&&r(s=>s+1)};function Je({skuId:s}){const[p,l]=t.useState([]),[d,v]=t.useState(null),[j,pe]=t.useState([]),[P,me]=t.useState(null),ne="http://localhost:8000",ye="test_runs\\\\";t.useEffect(()=>{A.get(`${ne}/api/file-explorer/`,{params:{sku_id:s,path:ye},headers:{accept:"application/json"}}).then(a=>{l(a.data.directories||[])}).catch(a=>console.error("Error fetching folders:",a))},[s]),t.useEffect(()=>{if(!d){pe([]);return}const a=`${ye}${d.name}`;A.get(`${ne}/api/file-explorer/`,{params:{sku_id:s,path:a},headers:{accept:"application/json"}}).then(S=>{const N=(S.data.files||[]).filter(L=>/\.(jpg|jpeg|png|webp|bmp|gif)$/i.test(L.url));pe(N)}).catch(S=>console.error("Error fetching files:",S))},[d,s]);const be=a=>{v(S=>(S==null?void 0:S.name)===a.name?null:a)};return e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"flex flex-col rounded-lg p-4 shadow-md gap-3 my-4 bg-white min-h-[540px]",children:[e.jsx("div",{className:"flex justify-between items-center px-4",children:e.jsx("h1",{className:"text-blue-500 font-semibold text-md",children:"Recent Executions"})}),p.length===0?e.jsx("p",{className:"text-center text-gray-500 mt-8",children:"No folders found"}):p.map(a=>e.jsxs("div",{onClick:()=>be(a),className:"bg-white flex flex-col gap-2 p-4 shadow-md border rounded-lg cursor-pointer hover:bg-blue-50 transition",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h4",{className:"font-medium",children:a.name}),e.jsxs("div",{className:"text-blue-600 font-semibold flex items-center gap-1",children:[(d==null?void 0:d.name)===a.name?"Close report":"View full report",e.jsx(we,{className:"text-green-600",size:16})]})]}),(d==null?void 0:d.name)===a.name&&e.jsx("div",{className:"mt-3",children:j.length===0?e.jsx("p",{className:"text-gray-500",children:"No image files found"}):e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 mt-2",children:j.map((S,W)=>e.jsx("div",{onClick:()=>me(S.url),className:"border rounded shadow p-1 cursor-pointer hover:scale-[1.02] transition",children:e.jsx("img",{src:S.url,alt:`Preview ${W}`,className:"w-full h-32 object-fill rounded"})},W))})})]},a.name)),P&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50",onClick:()=>me(null),children:e.jsxs("div",{className:"bg-white p-4 rounded shadow-lg max-w-4xl w-[90%] relative",onClick:a=>a.stopPropagation(),children:[e.jsx("button",{onClick:()=>me(null),className:"absolute right-0 top-0 p-1 m-1 text-red-500 outline-none border rounded-full",children:e.jsx(rt,{size:16,strokeWidth:2.4})}),e.jsx("img",{src:P,alt:"Preview",className:"w-full max-h-[80vh] object-contain rounded my-4"})]})})]})})}return e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:Ye,className:"bg-primary hover:bg-green-600 text-white py-2 px-4 rounded-full flex items-center gap-2",children:"New Performance Evaluation"})}),e.jsx(Je,{skuId:i}),w&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:De}),e.jsxs("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-[600px] bg-white shadow-lg rounded-lg p-6 z-50",children:[e.jsx("button",{onClick:De,className:"absolute top-4 right-4 text-green-600 hover:text-green-800",children:"✕"}),u?e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"relative mb-8",children:[e.jsx("div",{className:"absolute top-5 left-[6.5%] right-[6.5%] h-1 bg-gray-300 z-0 w-[84%]"}),e.jsx("div",{className:"absolute top-5 left-[6.5%] h-1 bg-green-600 z-10 transition-all duration-300",style:{width:`${Math.min(C/(fe.length-1)*90,90)}%`}}),e.jsx("div",{className:"flex justify-between items-start relative z-10",children:fe.map((s,p)=>e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center border-2 text-sm font-medium 
                            ${p<=C?"bg-green-600 border-green-600 text-white":"bg-white border-gray-300 text-gray-500"}`,children:p+1}),e.jsx("span",{className:"text-xs mt-2 text-center max-w-[140px]",children:s.label})]},p))})]}),C<fe.length&&e.jsx("div",{className:"mt-4 w-full",children:fe[C].component()}),e.jsx("div",{className:"flex flex-col pt-4",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs("div",{className:"flex flex-col gap-2 items-center justify-center",children:[C<fe.length-1&&e.jsx("button",{onClick:Qe,className:"w-48 m-2 py-2 px-4 rounded-full gap-2 text-white bg-primary hover:bg-green-600",children:C===fe.length-1?"Start":"Next"}),C===fe.length-1?e.jsx(e.Fragment,{}):e.jsxs("div",{className:"text-sm text-center",children:[e.jsx("span",{className:"font-semibold",children:"Disclaimer: "}),e.jsx("span",{children:"Proceeding to the next step may finalize your current choices. Please review your inputs carefully. Changes might not be possible later."})]})]})})})]}):e.jsxs("div",{className:"flex flex-col gap-4 items-center p-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 items-center justify-center",children:[e.jsx("div",{className:"text-blue-600 flex text-5xl font-bold",children:"Train"}),e.jsx("div",{className:"flex items-center text-center",children:"Got fresh data? Let’s teach your model how to make smart decisions. Select your annotations and start training!"}),e.jsx("button",{onClick:()=>h("training"),className:"bg-primary hover:bg-green-600 text-white py-2 px-4 rounded-full flex items-center gap-2",children:"Start Training"})]}),e.jsx("div",{className:"bg-black h-[1px] my-4 w-full"}),e.jsxs("div",{className:"flex flex-col gap-4 items-center justify-center",children:[e.jsx("div",{className:"text-blue-600 flex text-5xl font-bold",children:"Test"}),e.jsx("div",{className:"flex items-center text-center",children:"Already have a model? Let’s see how well it performs. Run it on test data and check the results."}),e.jsx("button",{onClick:()=>h("testing"),className:"bg-primary hover:bg-green-600 text-white py-2 px-4 rounded-full flex items-center gap-2",children:"Start Testing"})]})]})]})]})]})},Oe="http://localhost:8000/api/ai-camera/",Ct=({skuId:i,version:m,tags:F,configPath:V})=>{const[w,g]=t.useState(!1),[u,h]=t.useState(null),C=async()=>{var B;try{const E={sku_id:i.toString(),version_id:m.toString(),tag_name:F,end_point_url:"http://localhost:8000/api/capture-images/",camera_config_file:V||"C:\\Users\\reach\\Downloads\\default_camera.Config"};console.log(E);const T=await A.post(Oe,E,{headers:{"Content-Type":"application/json"}}),$=T.data["process.pid"]||((B=T.data.process)==null?void 0:B.pid);$?(h($),g(!0),console.log("Terminal opened with PID:",$)):console.error("PID not found in response:",T.data)}catch(E){console.error("Error opening terminal:",E)}},r=async()=>{var B,E;if(u)try{const T=await A.delete(`${Oe}${u}/`);(E=(B=T.data)==null?void 0:B.message)!=null&&E.includes("terminated")?(console.log(T.data.message),g(!1),h(null)):console.error("Unexpected response:",T.data)}catch(T){console.error("Error closing terminal:",T)}};return e.jsx("div",{className:"mt-4",children:w?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:r,disabled:!w,className:"bg-red-500 text-white px-4 py-2 rounded ml-2",children:"Stop Camera"}),u&&e.jsxs("p",{className:"text-sm mt-2 text-gray-700",children:["Active PID: ",u]})]}):e.jsx(e.Fragment,{children:e.jsx("button",{onClick:C,disabled:w,className:"bg-green-200 px-4 py-2 rounded",children:"Load from Indus Vision camera"})})})},St=({isOpen:i,onClose:m,skuId:F,versionId:V,onSuccess:w})=>{const[g,u]=t.useState([70,90]),[h,C]=t.useState(!1),r=t.useRef(null),B=(J,te)=>{if(!r.current)return;const se=r.current.getBoundingClientRect(),ge=te-se.left,he=Math.min(100,Math.max(0,ge/se.width*100)),x=[...g];J===0?x[0]=Math.min(he,g[1]-5):x[1]=Math.max(he,g[0]+5),u(x)},E=J=>te=>{const se=he=>B(J,he.clientX),ge=()=>{document.removeEventListener("mousemove",se),document.removeEventListener("mouseup",ge)};document.addEventListener("mousemove",se),document.addEventListener("mouseup",ge)},T=Math.round(g[0]),$=Math.round(g[1]-g[0]),ee=Math.round(100-g[1]),re=async()=>{try{C(!0);const J=await A.post("http://localhost:8000/api/split-data-set/",{sku_id:F,version_id:V,train_split:T,val_split:$,test_split:ee});f.success(J.data.message||"Split successful"),m(),w&&w()}catch(J){console.log(J)}finally{C(!1)}};return i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:m}),e.jsxs("div",{className:"fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-[700px] bg-white shadow-xl rounded-lg p-6 z-50",children:[e.jsx("button",{onClick:m,className:"absolute top-4 right-4 text-green-600 hover:text-green-800 text-xl font-bold",children:"✕"}),e.jsx("h2",{className:"text-2xl font-semibold text-center mb-6 text-green-700",children:"Dataset Split for Version"}),e.jsxs("div",{className:"flex justify-between mb-4 px-2 text-sm font-medium text-gray-700",children:[e.jsxs("span",{children:["Train: ",T,"%"]}),e.jsxs("span",{children:["Val: ",$,"%"]}),e.jsxs("span",{children:["Test: ",ee,"%"]})]}),e.jsxs("div",{ref:r,className:"relative h-4 bg-gray-200 rounded-full mb-6 select-none",children:[e.jsx("div",{className:"absolute h-full bg-green-500 rounded-l-full",style:{width:`${g[0]}%`}}),e.jsx("div",{className:"absolute h-full bg-blue-500",style:{left:`${g[0]}%`,width:`${g[1]-g[0]}%`}}),e.jsx("div",{className:"absolute h-full bg-red-500 rounded-r-full",style:{left:`${g[1]}%`,width:`${100-g[1]}%`}}),g.map((J,te)=>e.jsx("div",{className:"absolute top-1/2 transform -translate-y-1/2 -translate-x-1/2 w-5 h-5 bg-white border-2 border-green-600 rounded-full cursor-pointer z-10",style:{left:`${J}%`},onMouseDown:E(te)},te))]}),e.jsx("button",{onClick:re,className:"bg-green-600 hover:bg-green-700 text-white py-2 px-6 rounded-full",disabled:h,children:h?"Splitting...":"Submit Split"})]})]}):null},Re=({title:i="Confirm",message:m="Are you sure?",onConfirm:F,onCancel:V})=>e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-sm w-full",children:[e.jsx("h2",{className:"text-lg font-bold mb-2",children:i}),e.jsx("p",{className:"text-gray-700 mb-4",children:m}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:V,className:"bg-gray-300 px-4 py-1 rounded hover:bg-gray-400",children:"Cancel"}),e.jsx("button",{onClick:F,className:"bg-red-600 text-white px-4 py-1 rounded hover:bg-red-700",children:"Confirm"})]})]})}),Pt=()=>{const{workspaceId:i,skuId:m}=Ge(),[F,V]=Ve(),w=F.get("version"),g=F.get("tab")||"Versions",u=Le(),[h,C]=t.useState([]),[r,B]=t.useState([]),[E,T]=t.useState(w),$=async()=>{try{const x=await A.get(`http://localhost:8000/api/sku/${m}/`);B(x.data.results||[])}catch(x){console.error("Error fetching versions:",x)}},ee=async()=>{try{const x=await A.get(`http://localhost:8000/api/versions/?sku=${m}`);C(x.data.results||[])}catch(x){console.error("Error fetching versions:",x)}};t.useEffect(()=>{$(),ee()},[]),t.useEffect(()=>{$(),ee()},[m,w]),t.useEffect(()=>{T(w)},[w]);const re=t.memo(({sku:x})=>{const[O,k]=t.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>k(!0),className:"text-white px-4 py-2 bg-blue-600 hover:bg-blue-500 text-sm rounded-full transition",children:"Create Version"}),e.jsx(Be,{title:"",description:e.jsx(Nt,{sku:x,onSuccess:()=>{ee(),k(!1)},onCancel:()=>k(!1)}),hideFooter:!0,open:O,onOpenChange:k})]})}),J=({skuId:x})=>{const[O,k]=t.useState(null),[R,D]=Ve(),[q,Y]=t.useState(!1),[z,K]=t.useState([]),[H,I]=t.useState(!1),[b,o]=t.useState({source_version_id:null,target_version_id:null,overwrite:!1,skip_duplicates:!0,delete_source:!1}),U=c=>{K(G=>G.includes(c)?G.filter(ce=>ce!==c):[...G,c])},oe=()=>{if(z.length<2){alert("Please select at least two versions to merge.");return}I(!0)},ae=async()=>{if(z.length===0){alert("Please select at least one version to delete.");return}try{for(const c of z)await A.delete(`http://localhost:8000/api/versions/${c}/`,{headers:{accept:"application/json"}});console.log("Deleted versions:",z),K([]),ee(),f.success("deleted version",{position:"top-center",duration:4e3}),Y(!1)}catch(c){console.error("Delete failed:",c),alert("Failed to delete one or more versions.")}},X=()=>{Y(!1),K([])},xe=async()=>{if(!b.source_version_id||!b.target_version_id){alert("Please select source and target versions.");return}try{const c=await A.post("http://localhost:8000/api/sku-images/merge-versions/",{source_version_id:parseInt(b.source_version_id),target_version_id:parseInt(b.target_version_id),sku_id:parseInt(x),overwrite:b.overwrite,skip_duplicates:b.skip_duplicates,delete_source:b.delete_source},{headers:{accept:"application/json","Content-Type":"application/json"}});console.log("Merge successful:",c.data),I(!1),K([]),Y(!1)}catch(c){console.error("Merge failed:",c),alert("Failed to merge versions.")}},ie=()=>{I(!1)};return e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"flex gap-16 justify-end items-end mb-2",children:e.jsx(re,{sku:x})}),e.jsxs("div",{className:"flex items-center p-2 justify-between bg-gray-200 rounded-full mb-2",children:[H&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg w-[90%] max-w-md relative",children:[e.jsx("button",{className:"absolute top-2 right-2 text-gray-600",onClick:ie,children:"✕"}),e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Merge Versions"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Source Version"}),e.jsxs("select",{className:"w-full p-2 border rounded",value:b.source_version_id||"",onChange:c=>o({...b,source_version_id:c.target.value}),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Source Version"}),z.map(c=>{const G=h.find(ce=>ce.id===c);return e.jsx("option",{value:c,children:G.name},c)})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Target Version"}),e.jsxs("select",{className:"w-full p-2 border rounded",value:b.target_version_id||"",onChange:c=>o({...b,target_version_id:c.target.value}),children:[e.jsx("option",{value:"",disabled:!0,children:"Select Target Version"}),z.map(c=>{const G=h.find(ce=>ce.id===c);return e.jsx("option",{value:c,children:G.name},c)})]})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:b.overwrite,onChange:c=>o({...b,overwrite:c.target.checked})}),"Overwrite"]})}),e.jsx("div",{className:"mb-4",children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:b.skip_duplicates,onChange:c=>o({...b,skip_duplicates:c.target.checked})}),"Skip Duplicates"]})}),e.jsx("div",{className:"mb-4",children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:b.delete_source,onChange:c=>o({...b,delete_source:c.target.checked})}),"Delete Source"]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"px-3 py-1 bg-blue-600 text-white hover:bg-blue-700 rounded-full",onClick:xe,children:"Confirm Merge"}),e.jsx("button",{className:"px-3 py-1 bg-gray-600 text-white hover:bg-gray-700 rounded-full",onClick:ie,children:"Cancel"})]})]})}),e.jsxs("div",{className:"px-4 font-semibold",children:["Total Versions : ",h.length," "]}),q?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"px-3 py-1 bg-blue-600 text-white hover:bg-blue-700 rounded-full",onClick:oe,children:"Merge Version"}),e.jsx("button",{className:"px-3 py-1 bg-red-600 text-white hover:bg-red-700 rounded-full",onClick:ae,children:"Delete Version"}),e.jsx("button",{className:"px-3 py-1 bg-gray-600 text-white hover:bg-gray-700 rounded-full",onClick:X,children:"Back"})]}):e.jsxs("button",{className:"px-3 py-1 bg-red-600 text-white flex justify-center items-center gap-4 hover:bg-red-700 rounded-full",onClick:()=>Y(!0),children:["Bulk Version Edit ",e.jsx("img",{src:ze,alt:"Delete",className:"w-4 h-4"})]})]}),h.length>0?e.jsx(e.Fragment,{children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-3 mb-6",children:h.map(c=>e.jsxs("div",{onClick:()=>!q&&(k(c.id),D({tab:"SKU data",version:c.id})),className:`flex items-center justify-center flex-col gap-2 p-3 text-center rounded-lg shadow hover:bg-gray-100 cursor-pointer relative ${z.includes(c.id)?"bg-blue-100 border-2 border-blue-600":""} ${q?"cursor-default":""}`,children:[q&&e.jsx("input",{type:"checkbox",checked:z.includes(c.id),onChange:()=>U(c.id),className:"absolute top-2 left-2",onClick:G=>G.stopPropagation()}),e.jsx("img",{src:ve,alt:"",className:"w-8 h-8"}),e.jsx("h4",{className:"text-base font-medium",children:c.name})]},c.id))})}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col gap-3 text-2xl font-semibold text-[#BEBEBE] items-center justify-center min-h-[560px]",children:[e.jsx("div",{className:"flex",children:"No Versions to show"}),e.jsx("div",{className:"flex",children:"Click on Create Version button to create one"})]})}),O&&g==="SKU data"&&e.jsx("div",{className:"p-4 border rounded-lg shadow bg-gray-100",children:e.jsx(se,{skuId:x,version:O})})]})},te=({skuId:x})=>{const O=async()=>{try{const o=await A.get(`http://localhost:8000/api/final-data-set/?sku_id=${x}`);I(o.data||{})}catch(o){console.error("Failed to fetch datasets",o)}},[k,R]=t.useState(""),[D,q]=t.useState(!1),[Y,z]=t.useState(null),K=o=>{z(o),q(!0)},[H,I]=t.useState({});t.useEffect(()=>{O()},[x]);const b=async o=>{var U;try{const ae=(U=(await A.get(`http://localhost:8000/api/sku-images-list/?sku_id=${x}&version_id=${o}`)).data.results)==null?void 0:U.map(X=>({id:X.id,name:X.original_filename,url:`http://localhost:8000${X.image}`}));if(ae&&ae.length>0){R(o);const X=ae[0].id;u(`/client/workspaces/${i}/sku/${x}/image/${X}?tab=Annotate&version=${o}`)}else R(""),f.error("No images to display for this version",{position:"top-center",duration:4e3})}catch(oe){console.error("Failed to fetch images",oe),f.error("Failed to fetch images",{position:"top-center",duration:4e3})}};return e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"flex flex-col rounded-lg p-4 shadow-md gap-3 mb-2 bg-white",children:[e.jsx("h1",{className:"text-[#43996A] font-bold text-center text-xl",children:"Versions"}),!k&&h.map(o=>e.jsxs("div",{onClick:()=>b(o.id),className:"bg-white flex justify-center flex-col p-4 m-2 shadow-md hover:bg-slate-100 rounded-lg text-center cursor-pointer",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex gap-4 items-center justify-center",children:[e.jsx("img",{src:ve,alt:"",className:"w-4 h-4"}),e.jsx("h4",{className:"text-base font-medium",children:o.name})]}),e.jsx("button",{onClick:U=>{U.stopPropagation(),K(o.id)},children:e.jsx(we,{className:"w-5 h-5 text-blue-600 hover:text-blue-800"})})]}),e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(_e,{done:o.total_image_count>0?Math.round(o.labeled_image_count/o.total_image_count*100):0})}),e.jsxs("div",{className:"flex flex-col gap-1 items-start justify-start px-12",children:[e.jsxs("div",{className:"text-blue-500 font-semibold",children:["Annotated : ",o==null?void 0:o.labeled_image_count]}),e.jsxs("div",{className:"text-yellow-500 font-semibold",children:["Unannotated : ",o==null?void 0:o.unlabeled_image_count]}),e.jsxs("div",{className:"text-red-500 font-semibold",children:["Rejected : ",(o==null?void 0:o.rejected)||0]})]})]},o.id))]}),e.jsxs("div",{className:"flex flex-col rounded-lg p-4 shadow-md gap-3 mb-2 bg-white",children:[e.jsx("h1",{className:"text-[#43996A] font-bold text-center justify-center items-center text-xl",children:"Datasets"}),!k&&Object.entries(H).map(([o,U])=>e.jsx("div",{onClick:()=>V({tab:"Dataset",version:U==null?void 0:U.version_id}),className:"bg-white flex justify-center flex-col gap-2 p-4 m-2 shadow-md hover:bg-slate-100 rounded-lg text-center cursor-pointer",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex gap-4 items-center justify-center",children:[e.jsx("img",{src:ve,alt:"",className:"w-4 h-4"}),e.jsxs("h4",{className:"text-base font-medium",children:["Version ",o]})]}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["Total Images: ",e.jsx("span",{className:"font-semibold",children:U==null?void 0:U.count})]}),e.jsx("div",{className:"text-[#43996A] font-semibold",children:e.jsx(ht,{className:"w-5 h-5",fontSize:"small"})})]})},o))]}),D&&Y!==null&&e.jsx(St,{isOpen:D,onClose:()=>q(!1),skuId:x,versionId:Y,onSuccess:O})]})})},se=({skuId:x,version:O,mode:k="images"})=>{const[R,D]=t.useState(!1),[q,Y]=t.useState(()=>{}),[z,K]=t.useState(""),[H,I]=t.useState([]),[b,o]=t.useState([]),[U,oe]=t.useState(null),ae=async()=>{try{const n=k==="dataset"?`http://localhost:8000/api/data-set/?sku_id=${x}&version_id=${O}&absolute_path=false`:`http://localhost:8000/api/sku-images-list/?sku_id=${x}&version_id=${O}`,_=await A.get(n),y=k==="dataset"?_.data:_.data.results,je=y==null?void 0:y.map((Z,de)=>({id:Z.id??de,name:Z.original_filename??`Image ${de+1}`,url:`http://localhost:8000${Z.image}`,split:Z.split_label||null})),le=y==null?void 0:y.map((Z,de)=>({id:Z.id??de,name:Z.original_filename??`Image ${de+1}`,url:Z.image.startsWith("http")?Z.image:`http://localhost:8000${Z.image}`,split:Z.split_label||null}));I(le||[])}catch(n){console.error("Failed to fetch images",n)}};t.useEffect(()=>{ae()},[x,O,k]);const X=n=>{o(_=>_.includes(n)?_.filter(y=>y!==n):[..._,n])},xe=n=>{K("Are you sure you want to delete this image?"),Y(()=>async()=>{try{await A.delete("http://localhost:8000/api/sku-images/",{data:{image_ids:[n]}}),f.success("Image deleted successfully",{position:"top-center",duration:4e3}),ae()}catch{f.error("Failed to delete image",{position:"top-center",duration:4e3})}finally{D(!1)}}),D(!0)},ie=()=>{if(b.length===0){f.error("Please select images to delete.",{position:"top-center",duration:4e3});return}K(`Are you sure you want to delete ${b.length} image(s)?`),Y(()=>async()=>{try{await A.delete("http://localhost:8000/api/sku-images/",{data:{image_ids:b}}),f.success("Images deleted successfully",{position:"top-center",duration:4e3}),ae(),o([])}catch{f.error("Failed to delete images",{position:"top-center",duration:4e3})}finally{D(!1)}}),D(!0)},c=n=>oe(n),G=t.memo(({src:n,alt:_})=>e.jsx(Be,{title:"",description:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("img",{src:n,alt:_,className:"w-full h-auto max-h-[80vh] object-contain rounded"}),e.jsx("h1",{className:"mt-2",children:_})]}),children:e.jsx("button",{className:"bg-green-500 text-white text-xs px-3 py-1 rounded shadow",children:"Preview"})})),ce={train:"bg-blue-600",val:"bg-yellow-500",test:"bg-red-500"};return e.jsxs(e.Fragment,{children:[R&&e.jsx(Re,{title:"Confirm Delete",message:z,onCancel:()=>D(!1),onConfirm:q}),e.jsx("div",{className:"flex justify-end items-end mb-2 gap-4",children:k==="images"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:ie,className:"px-3 py-1 bg-red-600 text-white rounded-full",children:"Bulk Delete"}),e.jsx("button",{onClick:()=>V({tab:"upload",version:O}),className:"text-white text-md font-semibold bg-blue-600 rounded-full py-1 px-3",children:"Upload Files"})]})}),H.length>0?e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 p-4",children:H.map((n,_)=>e.jsxs("div",{className:"border rounded group p-2 relative",children:[n.split&&e.jsx("span",{className:`absolute top-2 left-2 text-white text-xs font-bold px-2 py-1 rounded-full ${ce[n.split]}`,children:n.split}),e.jsx("img",{src:n.url,alt:n.image,onClick:()=>c(_),className:"w-full h-28 object-cover rounded mb-2 cursor-pointer"}),k==="images"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-40 opacity-0 group-hover:opacity-100 transition",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(G,{src:n.url,alt:n.name}),e.jsx("button",{onClick:()=>xe(n.id),className:"bg-red-500 text-white text-xs px-3 py-1 rounded shadow",children:"Delete"})]})}),e.jsxs("div",{className:"flex gap-2 px-2 py-1 text-xs bg-white items-center",children:[e.jsx("input",{type:"checkbox",checked:b.includes(n.id),onChange:()=>X(n.id)}),e.jsx("span",{className:"text-black truncate w-28",title:n.name,children:n.name})]})]})]},n.id))}):e.jsx("div",{className:"text-center text-gray-400 font-medium py-24",children:"No images to show."})]})},ge=({skuId:x,version:O,tags:k})=>{const[R,D]=t.useState(!1),[q,Y]=t.useState(()=>{}),[z,K]=t.useState(""),[H,I]=t.useState([]),[b,o]=t.useState(Ee),[U,oe]=t.useState(!1),ae=n=>{n.preventDefault(),n.stopPropagation(),oe(!0)},X=n=>{n.preventDefault(),n.stopPropagation(),oe(!1)},xe=n=>{n.preventDefault(),n.stopPropagation(),oe(!1);const _=n.dataTransfer.files;ie(_)},ie=n=>{if(!n)return;const _=Array.from(n).filter(y=>["image/jpeg","image/jpg","image/png","image/bmp"].includes(y.type)).map(y=>({file:y,name:y.name,preview:URL.createObjectURL(y)}));I(y=>[...y,..._])},c=n=>{I(_=>{const y=_.filter((je,le)=>le!==n);return _[n].preview===b&&o(Ee),y})},G=async(n=!1,_=!1)=>{var je;const y=new FormData;H.forEach(({file:le})=>y.append("images",le)),y.append("sku_id",x),y.append("tags",k),y.append("version_name",O),y.append("version_id",O),y.append("allow_duplicates",n.toString()),y.append("overwrite",_.toString());try{const le=await A.post("http://localhost:8000/api/sku-images/",y);((je=le.data.skipped)==null?void 0:je.length)>0&&le.data.skipped.some(Z=>Z.reason.includes("Duplicate"))?(K(`${le.data.skipped.length} image(s) were skipped due to duplication.
Would you like to re-upload with overwrite?`),Y(()=>async()=>{D(!1),await G(!0,!0)}),D(!0)):(f.success("Upload successful!",{position:"top-center",duration:4e3}),V({tab:"SKU data",version:O}))}catch{f.error("Upload failed.",{position:"top-center",duration:4e3})}},ce=()=>{if(H.length===0){f.error("No images to upload",{position:"top-center",duration:4e3});return}G(!1,!1)};return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Upload SKU Data"}),e.jsx("button",{onClick:ce,className:"bg-blue-600 rounded-full text-white px-6 py-2",children:"Save"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"border-2 rounded-md border-dashed border-green-400 p-6 flex flex-col items-center justify-center",children:[e.jsx("img",{src:pt,alt:"Camera Icon",className:"w-16 h-16 mb-2"}),e.jsx(Ct,{skuId:x,version:O,tags:k,configPath:"C:\\\\Users\\\\reach\\\\Downloads\\\\Muesli Nuts Delight 1kg.Config"})]}),e.jsxs("div",{className:`border-2 border-dashed rounded-md p-6 text-center flex items-center justify-center transition-colors duration-200 ${U?"border-green-500 bg-green-50":"border-blue-400"}`,onDragOver:ae,onDragLeave:X,onDrop:xe,children:[e.jsx("input",{type:"file",accept:".jpg,.jpeg,.png,.bmp",multiple:!0,className:"hidden",id:"fileInput",onChange:n=>ie(n.target.files)}),e.jsxs("label",{htmlFor:"fileInput",className:"cursor-pointer flex flex-col justify-center items-center",children:[e.jsx("img",{src:gt,alt:"Upload Icon",className:"mb-4 w-24 h-24"}),e.jsx("div",{className:"text-white text-lg font-semibold bg-blue-600 rounded-full p-2",children:"Click to upload files from device"}),e.jsx("div",{className:"text-md text-gray-500 mt-1",children:"or drag and drop files here"}),e.jsxs("div",{className:"text-md mt-1",children:[e.jsx("span",{className:"text-red-400",children:"*"})," Files supported: .jpeg .jpg .png .bmp"]})]})]})]}),H.length>0?e.jsxs(e.Fragment,{children:[" ",e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"List of files uploading"}),H.length===0?e.jsx("div",{className:"text-gray-500 flex justify-center items-center text-lg border p-4 rounded h-64",children:"No files have been uploaded."}):e.jsx("div",{className:"grid gap-4 max-h-96 overflow-y-auto",children:H.map((n,_)=>e.jsxs("div",{className:"px-4 py-2 border rounded shadow-sm flex justify-between items-center bg-gray-100",children:[e.jsx("img",{src:n.preview,alt:`preview-${_}`,className:"w-16 h-16 object-fill rounded cursor-pointer",onClick:()=>o(n.preview)}),e.jsx("div",{children:n.name}),e.jsx("button",{onClick:()=>c(_),title:"Delete",className:"ml-2",children:e.jsx("img",{src:xt,alt:"Delete"})})]},_))})]}),e.jsx("div",{className:"mt-6 flex",children:e.jsx("img",{src:b,alt:"Selected Preview",className:"w-full h-96 object-fill rounded"})})]}),R&&e.jsx(Re,{title:"Re-upload Confirmation",message:z,onConfirm:q,onCancel:()=>D(!1)})]}):e.jsx(e.Fragment,{})]})},he=({skuId:x,version:O,tags:k})=>{const[R,D]=t.useState({labelName:"",shortcutKey:"",colorCode:"#EEE"}),[q,Y]=t.useState(0),[z,K]=t.useState(!1);t.useEffect(()=>{z||D({labelName:"",shortcutKey:"",colorCode:"#EEE"})},[z]);const H=async()=>{var I,b;try{await A.post("http://localhost:8000/api/label/",{name:R.labelName,sku_id:x,shortcut_key:R.shortcutKey.toUpperCase(),color_code:R.colorCode,is_active:!0}),f.success("Label added successfully!",{position:"top-center",duration:4e3}),D({labelName:"",shortcutKey:"",colorCode:"#000"}),Y(o=>o+1),K(!1)}catch(o){const U=(b=(I=o==null?void 0:o.response)==null?void 0:I.data)==null?void 0:b.message;f.error(U||"Failed to add label",{position:"top-center",duration:4e3})}};return e.jsxs("div",{className:"flex flex-col gap-2",children:[k=="AnamolyDetection"?e.jsx(e.Fragment,{}):e.jsx(e.Fragment,{children:e.jsx(ke,{title:"Add New Labels",description:e.jsx("div",{children:e.jsxs("form",{onSubmit:I=>I.preventDefault(),children:[e.jsx("input",{type:"text",className:"w-full px-2 py-1 border rounded-full my-2",placeholder:"Label name",value:R.labelName,onChange:I=>D({...R,labelName:I.target.value})}),e.jsx("input",{type:"text",className:"w-full px-2 py-1 border rounded-full mb-2",placeholder:"Keyboard Shortcut key (e.g., G)",value:R.shortcutKey,onChange:I=>D({...R,shortcutKey:I.target.value})}),e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium mb-2",children:["Select color:",e.jsx("input",{type:"color",className:"h-8 w-10 rounded-full border",value:R.colorCode,onChange:I=>D({...R,colorCode:I.target.value})})]})]})}),onConfirm:H,open:z,onOpenChange:K,children:e.jsx("div",{className:"flex items-end justify-end",children:e.jsx("button",{className:"w-32 px-3 py-1 bg-blue-600 text-white flex justify-center items-center gap-4 hover:bg-blue-500 rounded-full",children:"Add Labels"})})})}),e.jsx(yt,{skuId:x,refreshKey:q,tags:k})]})};return e.jsxs("div",{className:"p-4",children:[g==="Versions"&&e.jsx(J,{skuId:r==null?void 0:r.id}),g==="SKU data"&&e.jsx(se,{skuId:r==null?void 0:r.id,version:w,mode:"images"}),g==="Dataset"&&e.jsx(se,{skuId:r==null?void 0:r.id,version:w,mode:"dataset"}),g==="upload"&&e.jsx(ge,{skuId:r==null?void 0:r.id,version:w,tags:r==null?void 0:r.tag_name}),g==="Label"&&e.jsx(he,{skuId:r==null?void 0:r.id,version:w,tags:r==null?void 0:r.tag_name}),g==="Annotate"&&e.jsx(te,{skuId:r==null?void 0:r.id}),g==="Indus Vision AI"&&e.jsx(wt,{skuId:r==null?void 0:r.id,version:w,skuVersions:h,selectedVersion:E})]})};export{Pt as default};
