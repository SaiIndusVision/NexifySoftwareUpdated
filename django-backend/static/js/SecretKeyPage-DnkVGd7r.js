import{j as e}from"./mui-B_PChry4.js";import{A as f}from"./AuthLayout-DhFT6Tp4.js";import{b as h,s as x,n as j,d as g}from"./form-tools-DBwiXJwN.js";import{a as S,u as r,F as v,b as F,c as _,d as b,I as A,e as K,B as k,L as w,t as C}from"./index-Bv_2KTqU.js";import{u,i as N}from"./state-management-BfQTD3Fv.js";import{u as I,a as y}from"./data-utils-DaMdQHZx.js";import{f as L,L as M}from"./react-core-CQlor4TK.js";import"./ui-utils-DC4QuFVe.js";import"./radix-B0DvzVia.js";const T=()=>{const c=u(o=>o.auth.role_name),n=u(o=>o.auth.user_id);N();const t=L(),{mutate:a,isPending:d,error:s}=I({mutationFn:S.SecretKeyUser,onSuccess:async o=>{if(!o.valid){r.error("Invalid Secret key",{position:"top-center",duration:4e3});return}try{const i=await y.get("http://localhost:8000/api/system-info/",{headers:{Accept:"application/json"}}),m=await(i==null?void 0:i.data);if(!m.mac_address){r.error("MAC address not found",{position:"top-center",duration:4e3});return}const l=await y.post("http://localhost:8001/api/mac-address-update/",{id:n,mac_address:m.mac_address},{headers:{"Content-Type":"application/json",Accept:"application/json"}}),p=await(l==null?void 0:l.data);p.status===200?(r.success("Secret key validated & MAC address updated",{position:"top-center",duration:4e3}),t(c==="User"?"/client/workspaces":"/login")):r.error(p.message||"MAC update failed",{position:"top-center",duration:4e3})}catch(i){console.error(i),r.error("Failed to update MAC address",{position:"top-center",duration:4e3})}},onError:()=>{r.error("Invalid Secret key",{position:"top-center",duration:4e3})}});return{mutate:a,isLoading:d,error:s}},B=h({user_id:j().int({message:"User ID must be an integer"}),secret_key:x().min(1,"Secret Key is required")}),D=()=>{const{mutate:c,isLoading:n}=T(),t=u(s=>s.auth);console.log(t);const a=g({resolver:C(B),defaultValues:{user_id:t==null?void 0:t.user_id,secret_key:""}}),d=s=>{c(s)};return e.jsx(v,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(d),className:"space-y-6",children:[e.jsx(F,{control:a.control,name:"secret_key",render:({field:s})=>e.jsxs(_,{children:[e.jsx(b,{children:e.jsx("div",{className:"relative",children:e.jsx(A,{...s,type:"text",placeholder:"Secret Key*",autoComplete:"off",className:"rounded-full"})})}),e.jsx(K,{})]})}),e.jsx(k,{type:"submit",disabled:n,className:"w-full  rounded-full bg-[#43996A]",children:n?e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"mr-2 h-4 w-4 animate-spin"}),"Please wait"]}):"Validate Secret Key"}),e.jsx("div",{className:"text-center",children:e.jsx(M,{to:"/login",className:"text-sm font-normal font-secondary text-[#062393] hover:text-primary transition-colors",children:"Back to login"})})]})})},O=()=>e.jsx(f,{title:"SecretKey",children:e.jsx(D,{})});export{O as default};
