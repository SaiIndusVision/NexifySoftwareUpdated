import{j as e}from"./mui-BFA6lQrI.js";import{A as f}from"./AuthLayout-itFYPbID.js";import{b as h,s as x,n as j,d as g}from"./form-tools-DBwiXJwN.js";import{a as S,u as a,F as v,b as F,c as _,d as b,I as A,e as K,B as k,L as w,t as C}from"./index-uJeo5NJI.js";import{u as m,i as N}from"./state-management-hQ1z8sur.js";import{u as I,a as y}from"./data-utils-7BzZlo9U.js";import{f as L,L as M}from"./react-core-CQlor4TK.js";import"./ui-utils-DmSiVVjI.js";import"./radix-BHg8RD76.js";const T=()=>{const c=m(o=>o.auth.role_name),n=m(o=>o.auth.user_id);N();const s=L(),{mutate:r,isPending:d,error:t}=I({mutationFn:S.SecretKeyUser,onSuccess:async o=>{if(!o.valid){a.error("Invalid Secret key");return}try{const i=await y.get("http://localhost:8000/api/system-info/",{headers:{Accept:"application/json"}}),u=await(i==null?void 0:i.data);if(!u.mac_address){a.error("MAC address not found");return}const l=await y.post("http://localhost:8001/api/mac-address-update/",{id:n,mac_address:u.mac_address},{headers:{"Content-Type":"application/json",Accept:"application/json"}}),p=await(l==null?void 0:l.data);p.status===200?(a.success("Secret key validated & MAC address updated"),s(c==="User"?"/client/workspaces":"/login")):a.error(p.message||"MAC update failed")}catch(i){console.error(i),a.error("Failed to update MAC address")}},onError:()=>{a.error("Invalid Secret key")}});return{mutate:r,isLoading:d,error:t}},B=h({user_id:j().int({message:"User ID must be an integer"}),secret_key:x().min(1,"Secret Key is required")}),D=()=>{const{mutate:c,isLoading:n}=T(),s=m(t=>t.auth);console.log(s);const r=g({resolver:C(B),defaultValues:{user_id:s==null?void 0:s.user_id,secret_key:""}}),d=t=>{c(t)};return e.jsx(v,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(d),className:"space-y-6",children:[e.jsx(F,{control:r.control,name:"secret_key",render:({field:t})=>e.jsxs(_,{children:[e.jsx(b,{children:e.jsx("div",{className:"relative",children:e.jsx(A,{...t,type:"text",placeholder:"Secret Key*",autoComplete:"off",className:"rounded-full"})})}),e.jsx(K,{})]})}),e.jsx(k,{type:"submit",disabled:n,className:"w-full  rounded-full bg-[#43996A]",children:n?e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"mr-2 h-4 w-4 animate-spin"}),"Please wait"]}):"Validate Secret Key"}),e.jsx("div",{className:"text-center",children:e.jsx(M,{to:"/login",className:"text-sm font-normal font-secondary text-[#062393] hover:text-primary transition-colors",children:"Back to login"})})]})})},O=()=>e.jsx(f,{title:"SecretKey",children:e.jsx(D,{})});export{O as default};
