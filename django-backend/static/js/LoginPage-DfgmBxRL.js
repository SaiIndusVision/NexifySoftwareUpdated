import{j as e}from"./mui-BFA6lQrI.js";import{A as w}from"./AuthLayout-itFYPbID.js";import{f as v,b as L,r as A,L as u}from"./react-core-CQlor4TK.js";import{b as N,s as f,d as b}from"./form-tools-DBwiXJwN.js";import{a as F,u as r,s as k,F as E,b as h,c as x,d as g,I as j,e as _,B as C,L as P,t as S}from"./index-C_wsCyeP.js";import{u as M,a as y}from"./data-utils-7BzZlo9U.js";import{i as I}from"./state-management-hQ1z8sur.js";import{a as D,E as B}from"./eye-yBBobpnq.js";import"./ui-utils-DmSiVVjI.js";import"./radix-BHg8RD76.js";const q=()=>{const c=I(),l=v(),{mutate:m,isPending:d,error:a}=M({mutationFn:F.loginUser,onSuccess:async s=>{if(c(k({role_name:s.role_name,user_id:s.user_id,first_name:s.first_name,last_name:s.last_name,email:s.email,user_created_date:s.user_created_date,access_token:s.access_token,refresh_token:s.refresh_token,secret_key_verified:s.secret_key_verified})),s.message==="Login successful"){if(s.role_name==="Admin"){r.error("Invalid Credentials",{position:"top-center",duration:4e3});return}try{const t=await y.get("http://localhost:8000/api/system-info/",{headers:{Accept:"application/json"}}),o=(await(t==null?void 0:t.data)).mac_address,i=await y.get(`http://localhost:8001/api/mac-address-validate/?user_id=${s.user_id}&mac_address=${o}`,{headers:{Accept:"application/json"}}),p=await(i==null?void 0:i.data);p.status===200?(r.success("Login successful",{position:"top-center",duration:4e3}),s.secret_key_verified?l("/client/workspaces"):l("/client/secret-key")):r.error(p.message||"MAC address is invalid.",{position:"top-center",duration:4e3})}catch(t){r.error("Failed to Login",{position:"top-center",duration:4e3}),console.error("MAC validation error:",t)}}else r.error("Invalid user",{position:"top-center",duration:4e3})},onError:s=>{var t,n,o,i;((n=(t=s==null?void 0:s.response)==null?void 0:t.data)==null?void 0:n.message)==="Invalid email or password"?r.error(s.response.data.message,{position:"top-center",duration:4e3}):r.error(((i=(o=s==null?void 0:s.response)==null?void 0:o.data)==null?void 0:i.message)||"Login failed",{position:"top-center",duration:4e3})}});return{mutate:m,isLoading:d,error:a}},O=N({email:f().min(1,"Email is required").email("Please enter a valid email"),password:f().min(1,"Password is required")}),T=()=>{const[c,l]=L.useState(!1),{mutate:m,isLoading:d}=q(),a=b({resolver:S(O),defaultValues:{email:"",password:""}}),s=t=>{m(t)};return A.useEffect(()=>{(async()=>{try{const o=await(await fetch("http://localhost:8000/api/system-info/",{headers:{Accept:"application/json"}})).json();o.mac_address&&console.log("currect_mac",o.mac_address)}catch(n){console.error("Failed to fetch MAC address",n)}})()},[]),e.jsxs(E,{...a,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-2xl font-secondary font-bold text-[#062393]",children:"Welcome Back!"}),e.jsx("div",{className:"text-sm font-secondary  font-normal ",children:"Let's get started"})]}),e.jsxs("form",{onSubmit:a.handleSubmit(s),className:"space-y-6",children:[e.jsx(h,{control:a.control,name:"email",render:({field:t})=>e.jsxs(x,{children:[e.jsx(g,{children:e.jsx(j,{...t,type:"email",placeholder:"Email Address*",autoComplete:"off",hasError:!!a.formState.errors.email,className:"rounded-full"})}),e.jsx(_,{})]})}),e.jsx(h,{control:a.control,name:"password",render:({field:t})=>e.jsxs(x,{children:[e.jsx(g,{children:e.jsxs("div",{className:"relative",children:[e.jsx(j,{...t,type:c?"text":"password",placeholder:"Password*",autoComplete:"off",hasError:!!a.formState.errors.password,className:"rounded-full"}),e.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center hover:text-accent-foreground",onClick:()=>l(!c),children:c?e.jsx(D,{className:"h-5 w-5 text-muted-foreground"}):e.jsx(B,{className:"h-5 w-5 text-muted-foreground"})})]})}),e.jsx(_,{})]})}),e.jsx(C,{type:"submit",disabled:d,className:"w-full font-secondary rounded-full bg-[#43996A]",children:d?e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"mr-2 h-4 w-4 animate-spin"}),"Please wait"]}):"Login"}),e.jsxs("div",{className:"text-center ",children:[e.jsx(u,{to:"/send-password-reset-link",className:"text-sm font-normal font-secondary text-[#062393] hover:text-primary transition-colors",children:"Forgot Password"}),e.jsx("br",{}),e.jsx(u,{to:"/sign-up",className:"text-sm font-normal font-secondary text-[#062393] hover:text-primary transition-colors",children:"Don't have an Account ? Create One"})]})]})]})},R=()=>e.jsx(w,{title:"Login",children:e.jsx(T,{})});export{R as default};
