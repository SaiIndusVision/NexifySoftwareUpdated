import{j as r}from"./mui-B_PChry4.js";import{r as a,f as q,b as B,h as Z,u as z}from"./react-core-CQlor4TK.js";import{A as X}from"./AuthLayout-DhFT6Tp4.js";import{t as Y,F as J,b as D,c as R,d as b,I as k,e as M,B as K,f as E,A as F,u as A,R as L,g as p,L as Q}from"./index-Bv_2KTqU.js";import{d as ss,b as es,s as N}from"./form-tools-DBwiXJwN.js";import{a as U,E as H}from"./eye-CO8B98Bc.js";import{a as ts}from"./data-utils-DaMdQHZx.js";import"./state-management-BfQTD3Fv.js";import"./ui-utils-DC4QuFVe.js";import"./radix-B0DvzVia.js";const rs=e=>es({...e?{}:{currentPassword:N().min(1,"Current password is required")},password:N().nonempty("Password is required").min(8,"Password must be  8+ characters with uppercase, number, and specialÂ character").regex(/[A-Z]/,"Password must include at least one uppercase letter").regex(/[0-9]/,"Password must include at least one number").regex(/[^A-Za-z0-9]/,"Password must include at least one special character"),confirmPassword:N().min(1,"Confirm password is required")}).refine(s=>s.password===s.confirmPassword,{message:"Passwords don't match",path:["confirmPassword"]}),os=({userId:e,token:s,isResetPassword:t=!1})=>{const[n,d]=a.useState(!1),f=q(),[w,y]=a.useState(!1),[x,g]=B.useState(!1),l=ss({resolver:Y(rs(t)),defaultValues:{...t?{}:{currentPassword:""},password:"",confirmPassword:""}}),T=async c=>{var h,m,u,C,_,v;d(!0);try{if(t&&s&&e){if((await E.post("/reset-link-validate/",{token:s})).status!==200)throw new Error("The password reset link is invalid or has expired.");const I={token:s,new_password:c.password,confirm_password:c.confirmPassword};console.log(I);const ws=await E.put(`${F.AUTH.FORGOT_PASSWORD}${e}/`,I);A.success("Password reset email sent successfully",{position:"top-center",duration:4e3}),f(L.AUTH.LOGIN)}else{const o={new_password:c.password,confirm_password:c.confirmPassword};await E.post(F.AUTH.CHANGE_PASSWORD,o),A.success("Password reset successfully",{position:"top-center",duration:4e3})}}catch(o){((m=(h=o==null?void 0:o.response)==null?void 0:h.data)==null?void 0:m.message)=="Link has expired, please request a new one to reset your password."?(A.error(`${(C=(u=o==null?void 0:o.response)==null?void 0:u.data)==null?void 0:C.message}`,{position:"top-center",duration:4e3}),f(L.AUTH.SEND_PASSWORD_RESET)):(console.log(o),console.error("Password change error:",o),A.error(`${(v=(_=o==null?void 0:o.response)==null?void 0:_.data)==null?void 0:v.message}`,{position:"top-center",duration:4e3}))}d(!1)};return r.jsx(J,{...l,children:r.jsxs("form",{onSubmit:l.handleSubmit(T),className:"space-y-4",children:[r.jsx(D,{control:l.control,name:"password",render:({field:c})=>r.jsxs(R,{children:[r.jsx(b,{children:r.jsxs("div",{className:"relative",children:[r.jsx(k,{...c,type:w?"text":"password",placeholder:"New Password*",autoComplete:"off",hasError:!!l.formState.errors.password,className:"rounded-full"}),r.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center hover:text-accent-foreground",onClick:()=>y(!w),children:w?r.jsx(U,{className:"h-5 w-5 text-muted-foreground"}):r.jsx(H,{className:"h-5 w-5 text-muted-foreground"})})]})}),r.jsx(M,{})]})}),r.jsx(D,{control:l.control,name:"confirmPassword",render:({field:c})=>r.jsxs(R,{children:[r.jsx(b,{children:r.jsxs("div",{className:"relative",children:[r.jsx(k,{...c,type:x?"text":"password",placeholder:"Confirm Password*",autoComplete:"off",hasError:!!l.formState.errors.confirmPassword,className:"rounded-full"}),r.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center hover:text-accent-foreground",onClick:()=>g(!x),children:x?r.jsx(U,{className:"h-5 w-5 text-muted-foreground"}):r.jsx(H,{className:"h-5 w-5 text-muted-foreground"})})]})}),r.jsx(M,{})]})}),r.jsx(K,{type:"submit",className:"w-full font-secondary rounded-full bg-[#43996A]",disabled:n,children:n?"Processing...":t?"Reset Password":"Change Password"})]})})},as=a.forwardRef(({className:e,...s},t)=>r.jsx("div",{ref:t,className:p("rounded-xl border bg-card text-card-foreground shadow",e),...s}));as.displayName="Card";const V=a.forwardRef(({className:e,...s},t)=>r.jsx("div",{ref:t,className:p("flex flex-col space-y-1.5 p-6",e),...s}));V.displayName="CardHeader";const $=a.forwardRef(({className:e,...s},t)=>r.jsx("div",{ref:t,className:p("font-semibold leading-none tracking-tight",e),...s}));$.displayName="CardTitle";const G=a.forwardRef(({className:e,...s},t)=>r.jsx("div",{ref:t,className:p("text-sm text-muted-foreground",e),...s}));G.displayName="CardDescription";const W=a.forwardRef(({className:e,...s},t)=>r.jsx("div",{ref:t,className:p("p-6 pt-0",e),...s}));W.displayName="CardContent";const ns=a.forwardRef(({className:e,...s},t)=>r.jsx("div",{ref:t,className:p("flex items-center p-6 pt-0",e),...s}));ns.displayName="CardFooter";const ds=3,cs=1e3,i={ADD_TOAST:"ADD_TOAST",UPDATE_TOAST:"UPDATE_TOAST",DISMISS_TOAST:"DISMISS_TOAST",REMOVE_TOAST:"REMOVE_TOAST"};let O=0;function is(){return O=(O+1)%Number.MAX_SAFE_INTEGER,O.toString()}const ls=new Map,ms=(e,s)=>{switch(s.type){case i.ADD_TOAST:return{...e,toasts:[s.toast,...e.toasts].slice(0,ds)};case i.UPDATE_TOAST:return{...e,toasts:e.toasts.map(t=>t.id===s.toast.id?{...t,...s.toast}:t)};case i.DISMISS_TOAST:{const{toastId:t}=s;return t&&ls.set(t,setTimeout(()=>{S({type:i.REMOVE_TOAST,toastId:t})},cs)),{...e,toasts:e.toasts.map(n=>n.id===t||t===void 0?{...n,open:!1}:n)}}case i.REMOVE_TOAST:return s.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(t=>t.id!==s.toastId)}}},P=[];let j={toasts:[]};function S(e){j=ms(j,e),P.forEach(s=>{s(j)})}function us({...e}){const s=is(),t=d=>S({type:i.UPDATE_TOAST,toast:{...d,id:s}}),n=()=>S({type:i.DISMISS_TOAST,toastId:s});return S({type:i.ADD_TOAST,toast:{...e,id:s,open:!0,onOpenChange:d=>{d||n()}}}),{id:s,dismiss:n,update:t}}function ps(){const[e,s]=a.useState(j);return a.useEffect(()=>(P.push(s),()=>{const t=P.indexOf(s);t>-1&&P.splice(t,1)}),[e]),{...e,toast:us,dismiss:t=>S({type:i.DISMISS_TOAST,toastId:t})}}const fs=()=>{const{toast:e,...s}=ps();return{toast:e,...s}},Ns=()=>{const[e,s]=a.useState(null),[t,n]=a.useState(!0),[d,f]=a.useState(null),{id:w}=Z(),y=z(),x=q(),{toast:g}=fs();return a.useEffect(()=>{const T=new URLSearchParams(y.search).get("token");if(console.log(T),!T){f("No reset token found. Please request a new password reset link."),n(!1);return}(async()=>{var h;try{s(T)}catch(m){console.error("Token validation error:",m);let u="Invalid or expired reset token. Please request a new password reset link.";ts.isAxiosError(m)&&m.response&&(u=((h=m.response.data)==null?void 0:h.message)||u),f(u),g({variant:"destructive",title:"Error",description:u})}finally{n(!1)}})()},[y,x,g]),r.jsxs(X,{children:[r.jsxs(V,{children:[r.jsx($,{className:"text-2xl font-bold text-center",children:"Reset Password"}),r.jsx(G,{className:"text-center",children:"Create a new password for your account"})]}),r.jsx(W,{children:t?r.jsx("div",{className:"flex justify-center items-center py-8",children:r.jsx(Q,{className:"h-8 w-8 animate-spin text-primary"})}):d?r.jsx("div",{className:"text-center space-y-4",children:r.jsx("p",{className:"text-destructive",children:d})}):e&&r.jsx(os,{userId:w,token:e,isResetPassword:!0})})]})};export{Ns as default};
