import{j as e}from"./mui-Bss3QQll.js";import{r,h as R,u as Y}from"./react-core-spor8t4e.js";import{z as o,d as q}from"./form-tools-C_3viVMX.js";import{h as k,r as L,j as G,t as H,g as u}from"./index-CNItTNil.js";import{u as V,a as J,F as Q,S as A}from"./useUserUpdate-CN3eCDIC.js";import{a as C}from"./data-utils-CsUIpaiA.js";import{i as X}from"./state-management-7spMuoR3.js";import"./ui-utils-D3kZWK2d.js";import"./radix-B4zV8Utj.js";import"./userApi-BqluZRjZ.js";/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],D=k("ArrowLeft",Z);/**
 * @license lucide-react v0.474.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M8 4H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2",key:"4jdomd"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v4",key:"3hqy98"}],["path",{d:"M21 14H11",key:"1bme5i"}],["path",{d:"m15 10-4 4 4 4",key:"5dvupr"}]],se=k("ClipboardCopy",ee),te=o.object({first_name:o.string().min(1,"First name is required"),last_name:o.string().min(1,"Last name is required"),email:o.string().email("Invalid email format"),phone_number:o.string().min(10,"Phone number must be at least 10 digits").max(15,"Phone number must be no more than 15 digits"),mac_address:o.string().optional().or(o.literal(null)).or(o.string().length(0)),role_id:o.coerce.number().min(1,"Invalid role selected"),started_on:o.string().regex(/^\d{4}-\d{2}-\d{2}$/,"Start date must be in YYYY-MM-DD format")}),ae=({children:p})=>{X();const[m,f]=r.useState(!1),i=async()=>{window.history.back()};return e.jsx(L,{title:"Leaving this page",description:"Leaving this page without saving might cause data loose, because there are unsaved data changes",onConfirm:i,isLoading:m,cancelButton:"Don't save",successButton:"Save changes",children:p})},ne=()=>{const[p,m]=r.useState(window.innerWidth);return r.useEffect(()=>{const f=()=>m(window.innerWidth);return window.addEventListener("resize",f),()=>window.removeEventListener("resize",f)},[]),p},ie=()=>{var z;ne();const{id:p}=R(),{setTitle:m}=G(),i=((z=Y().state)==null?void 0:z.selectedRow)||null;r.useEffect(()=>{m("Create Client")},[m]);const j=q({resolver:H(te),defaultValues:{first_name:"",last_name:"",email:"",phone_number:"",password:"",mac_address:"",role_id:1,started_on:""}}),{control:re,reset:g,formState:{errors:oe,isSubmitting:le},handleSubmit:U}=j,{mutate:$}=V({onUserCreateSuccess:s=>{g({})}});J({user_id:Number(p),onUserUpdateSuccess:s=>{console.log(s),g({})}});const[t,E]=r.useState([]),[y,h]=r.useState(!1),[I,w]=r.useState([]),b=async()=>{h(!0);const n=(await C.get(`http://localhost:8001/api/user/${i.id}/`)).data.results;E(n),h(!1)},N=async()=>{h(!0);const n=(await C.get(`http://localhost:8001/api/workspace/?created_by=${i.id}`)).data.results;w(n),h(!1)};r.useEffect(()=>{N(),b()},[]),r.useEffect(()=>{i&&Object.keys(i).length>0&&g({first_name:i.first_name||"",last_name:i.last_name||"",email:i.email||"",phone_number:i.phone_number||"",mac_address:i.mac_address||"",role_id:i.role_id||1,started_on:i.started_on||""}),b(),N()},[i,g]);const P=U(async s=>{const n={first_name:s.first_name,last_name:s.last_name,email:s.email,phone_number:s.phone_number,mac_address:s.mac_address||null,role_id:s.role_id,is_active:!0,started_on:s.started_on};console.log(n),$({first_name:s.first_name,last_name:s.last_name,email:s.email,phone_number:Number(s.phone_number),password:s.password||null,mac_address:s.mac_address||null,role_id:s.role_id,is_active:!0,started_on:s.started_on})}),W=s=>!s.is_activated&&s.failed_activation_attempts>2,T=async(s,n)=>{try{const a=await fetch(`http://localhost:8001/api/user/${s}/`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({is_authorized:n})});if(!a.ok)throw new Error("Failed to update user status");const l=await a.json();console.log("Updated:",l),b()}catch(a){console.error("Error updating user status:",a),alert("Something went wrong while updating user status.")}},[S,B]=r.useState([]),[_,F]=r.useState("");console.log(S),r.useEffect(()=>{fetch("http://localhost:8001/api/user/?role=3").then(s=>s.json()).then(s=>B(s.results)).catch(s=>console.error("Failed to fetch users",s))},[]);const M=async s=>{h(!0);try{const a=await(await fetch("http://localhost:8001/api/workspace-activate/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({workspace_id:s,field_assistant:Number(_)})})).json();w(l=>l.map(d=>d.id===s?{...d,activation_key:a.activation_key,activation_key_expiry:a.activation_key_expiry,field_assistant:a.field_assistant_id}:d)),alert(`✅ ${a.message} - Key: ${a.activation_key}`)}catch{alert("❌ Activation failed")}finally{h(!1)}};return e.jsx(e.Fragment,{children:y?e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex justify-center items-center min-h-screen flex-col",children:e.jsxs("div",{className:"flex flex-row space-x-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-full animate-spin\r
                    border-2 border-solid border-blue-500 border-t-transparent`}),e.jsx("h1",{children:"Loading..."})]})})}):e.jsx(e.Fragment,{children:e.jsx(Q,{methods:j,children:e.jsxs("form",{onSubmit:P,children:[e.jsx(A,{children:e.jsx("div",{className:"flex flex-col lg:flex-row gap-4 px-8 py-4",children:e.jsx("div",{className:"w-full  flex flex-col lg:flex-row gap-4",children:e.jsx("div",{className:"w-full ",children:e.jsxs("div",{className:u("border-[0.25px] border-slate-600 rounded-2xl","odz-table-row p-3 flex justify-between","bg-blue-100"),children:[e.jsxs("div",{className:"text-xl font-secondary px-4 font-bold flex gap-4 items-center ",children:[e.jsx("span",{className:"cursor-pointer",children:e.jsx(ae,{children:e.jsx(D,{})})}),e.jsxs("span",{className:"text-[#062393]",children:[t==null?void 0:t.first_name," ",t==null?void 0:t.last_name]})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("p",{className:"text-lg",children:"User status "}),e.jsxs("select",{value:(t==null?void 0:t.is_verified)===null?"pending":t!=null&&t.is_verified?"authorized":"unauthorized",onChange:async s=>{const n=s.target.value,a=n==="authorized"?!0:n==="unauthorized"?!1:null,l=a===!0?"authorize":a===!1?"unauthorize":"set as pending";if(!window.confirm(`Are you sure you want to ${l} this workspace?`)){s.target.value=(t==null?void 0:t.is_verified)===null?"pending":t!=null&&t.is_verified?"authorized":"unauthorized";return}await T(t==null?void 0:t.id,a)},className:u("rounded-2xl px-2 py-1 border text-white",(t==null?void 0:t.is_verified)==!0?"bg-green-500":(t==null?void 0:t.is_verified)===!1?"bg-red-500":"bg-orange-500"),children:[e.jsx("option",{value:"authorized",className:"bg-white text-black",children:"Authorized"}),e.jsx("option",{value:"unauthorized",className:"bg-white text-black",children:"UnAuthorized"})]})]})]})})})})}),e.jsxs(A,{children:[e.jsx("div",{className:"text-xl font-secondary px-8 font-bold text-[#062393]",children:"Profile Information"}),e.jsx("div",{className:"flex flex-col gap-4 px-8 py-4",children:(Array.isArray(t)?t:[t]).map((s,n)=>{const a=["first_name","last_name","email","country_code","phone_number","is_verified","role_id","started_on","secret_key"],l=Object.entries(s).filter(([c])=>a.includes(c)),d=Math.ceil(l.length/2),K=l.slice(0,d),O=l.slice(d);return e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 rounded-2xl ",children:[e.jsx("div",{className:"w-full border-[0.25px] border-slate-600 rounded-2xl",children:K.map(([c,v],x)=>e.jsxs("div",{className:u("odz-table-row p-3 flex justify-between ",x%2===0?"bg-blue-100":"bg-[#F6FBFF]"),children:[e.jsx("p",{className:"capitalize",children:c.replace(/_/g," ")}),e.jsx("p",{children:String(v)})]},`${c}-${x}`))}),e.jsx("div",{className:"w-full border-[0.25px] border-slate-600 rounded-2xl",children:O.map(([c,v],x)=>e.jsxs("div",{className:u("odz-table-row p-3 flex justify-between",x%2===0?"bg-blue-100":"bg-[#F6FBFF]"),children:[e.jsx("p",{className:"capitalize",children:c.replace(/_/g," ")}),e.jsx("p",{children:String(v)})]},`${c}-${x}`))})]},n)})})]}),e.jsx("div",{className:"text-xl font-secondary px-8 font-bold text-[#062393]",children:" Assigned Workspaces"}),e.jsx("div",{className:u("px-8 w-full rounded-2xl"),children:e.jsxs("table",{className:"min-w-full px-8 rounded-2xl border text-sm bg-background ",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"odz-table-row bg-[#020B2D] text-white hover:bg-[#020B2D] p-3",children:[e.jsx("th",{className:"p-2 border",children:"Workspaces"}),e.jsx("th",{className:"p-2 border",children:"Onboarding Date"}),e.jsx("th",{className:"p-2 border",children:"Activation Key"})]})}),e.jsx("tbody",{children:I.map((s,n)=>e.jsxs("tr",{className:u("hover:bg-accent",n%2===0?"bg-blue-100":"bg-[#F6FBFF]"),children:[e.jsx("td",{className:"p-2 border",children:s.name}),e.jsx("td",{className:"p-2 border",children:new Date(s.created_at).toLocaleString()}),e.jsx("td",{className:"p-2 border space-x-2 min-w-[10rem]",children:s.activation_key?(s.is_activated===!0||s.attempts<=3,e.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(s.activation_key||""),alert("Copied activation key to clipboard!")},className:`w-60 p-2 rounded-full text-white flex items-center justify-center gap-2 ${s.is_activated===!1?"bg-red-500":s.is_activated===null?"bg-orange-500 cursor-not-allowed":"bg-green-500"} ${W(s)?"border-2 border-red-700":""}`,children:[s.activation_key,e.jsx(se,{className:"w-4 h-4"})]})):e.jsx(L,{title:"Generate Activation Key",description:e.jsxs("div",{children:[e.jsx("p",{className:"mb-2",children:"Enter the Field Assistant ID to generate a key."}),e.jsxs("select",{className:"w-full px-2 py-1 border rounded",value:_,onChange:a=>F(a.target.value),children:[e.jsx("option",{value:"",children:"Select Field Assistant"}),S.map(a=>e.jsxs("option",{value:a.id,children:[a.first_name," ",a.last_name," (",a.email,")"]},a.id))]})]}),onConfirm:()=>M(s.id),isLoading:y,children:e.jsx("button",{className:"w-60 px-2 py-1 bg-green-500 text-white rounded",children:"Generate Activation Key"})})})]},s.id))})]})}),e.jsx("input",{type:"text",value:_,onChange:s=>F(s.target.value),placeholder:"Field Assistant ID",className:"hidden"})]})})})})},_e=()=>e.jsx(ie,{});export{_e as UserCreation,_e as default};
//# sourceMappingURL=page-DWqyogPy.js.map
