import{j as e}from"./mui-BFA6lQrI.js";import{A as w}from"./AuthLayout-itFYPbID.js";import{f as v,b as L,r as A,L as f}from"./react-core-CQlor4TK.js";import{b as N,s as p,d as b}from"./form-tools-DBwiXJwN.js";import{a as F,u as o,s as k,F as E,b as h,c as x,d as g,I as j,e as _,B as C,L as P,t as S}from"./index-uJeo5NJI.js";import{u as M,a as y}from"./data-utils-7BzZlo9U.js";import{i as I}from"./state-management-hQ1z8sur.js";import{a as D,E as B}from"./eye-CCVSL-Ve.js";import"./ui-utils-DmSiVVjI.js";import"./radix-BHg8RD76.js";const q=()=>{const c=I(),l=v(),{mutate:m,isPending:d,error:t}=M({mutationFn:F.loginUser,onSuccess:async s=>{if(c(k({role_name:s.role_name,user_id:s.user_id,first_name:s.first_name,last_name:s.last_name,email:s.email,user_created_date:s.user_created_date,access_token:s.access_token,refresh_token:s.refresh_token,secret_key_verified:s.secret_key_verified})),s.message==="Login successful"){if(s.role_name==="Admin"){o.error("Invalid Credentials");return}try{const a=await y.get("http://localhost:8000/api/system-info/",{headers:{Accept:"application/json"}}),r=(await(a==null?void 0:a.data)).mac_address,i=await y.get(`http://localhost:8001/api/mac-address-validate/?user_id=${s.user_id}&mac_address=${r}`,{headers:{Accept:"application/json"}}),u=await(i==null?void 0:i.data);u.status===200?(o.success("Login successful"),s.secret_key_verified?l("/client/workspaces"):l("/client/secret-key")):o.error(u.message||"MAC address is invalid.")}catch(a){o.error("Failed to Login"),console.error("MAC validation error:",a)}}else o.error("Invalid user")},onError:s=>{var a,n,r,i;((n=(a=s==null?void 0:s.response)==null?void 0:a.data)==null?void 0:n.message)==="Invalid email or password"?o.error(s.response.data.message):o.error(((i=(r=s==null?void 0:s.response)==null?void 0:r.data)==null?void 0:i.message)||"Login failed")}});return{mutate:m,isLoading:d,error:t}},O=N({email:p().min(1,"Email is required").email("Please enter a valid email"),password:p().min(1,"Password is required")}),T=()=>{const[c,l]=L.useState(!1),{mutate:m,isLoading:d}=q(),t=b({resolver:S(O),defaultValues:{email:"",password:""}}),s=a=>{m(a)};return A.useEffect(()=>{(async()=>{try{const r=await(await fetch("http://localhost:8000/api/system-info/",{headers:{Accept:"application/json"}})).json();r.mac_address&&console.log("currect_mac",r.mac_address)}catch(n){console.error("Failed to fetch MAC address",n)}})()},[]),e.jsxs(E,{...t,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-2xl font-secondary font-bold text-[#062393]",children:"Welcome Back!"}),e.jsx("div",{className:"text-sm font-secondary  font-normal ",children:"Let's get started"})]}),e.jsxs("form",{onSubmit:t.handleSubmit(s),className:"space-y-6",children:[e.jsx(h,{control:t.control,name:"email",render:({field:a})=>e.jsxs(x,{children:[e.jsx(g,{children:e.jsx(j,{...a,type:"email",placeholder:"Email Address*",autoComplete:"off",hasError:!!t.formState.errors.email,className:"rounded-full"})}),e.jsx(_,{})]})}),e.jsx(h,{control:t.control,name:"password",render:({field:a})=>e.jsxs(x,{children:[e.jsx(g,{children:e.jsxs("div",{className:"relative",children:[e.jsx(j,{...a,type:c?"text":"password",placeholder:"Password*",autoComplete:"off",hasError:!!t.formState.errors.password,className:"rounded-full"}),e.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center hover:text-accent-foreground",onClick:()=>l(!c),children:c?e.jsx(D,{className:"h-5 w-5 text-muted-foreground"}):e.jsx(B,{className:"h-5 w-5 text-muted-foreground"})})]})}),e.jsx(_,{})]})}),e.jsx(C,{type:"submit",disabled:d,className:"w-full font-secondary rounded-full bg-[#43996A]",children:d?e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"mr-2 h-4 w-4 animate-spin"}),"Please wait"]}):"Login"}),e.jsxs("div",{className:"text-center ",children:[e.jsx(f,{to:"/send-password-reset-link",className:"text-sm font-normal font-secondary text-[#062393] hover:text-primary transition-colors",children:"Forgot Password"}),e.jsx("br",{}),e.jsx(f,{to:"/sign-up",className:"text-sm font-normal font-secondary text-[#062393] hover:text-primary transition-colors",children:"Don't have an Account ? Create One"})]})]})]})},R=()=>e.jsx(w,{title:"Login",children:e.jsx(T,{})});export{R as default};
